<div id="ubz-302-visualization-container">
  <style type="text/css">
    .dashboard-container {
      text-align: left;
      background-color: whitesmoke;
    }

    .dashboard-header {
      margin-top: 1em;
      font-size: larger;
      font-weight: bold;
      text-align: center;
      border-bottom: 1px solid #9a9a9a;
    }

    .ubz-parameters-header {
      font-size: larger;
      font-weight: bold;
      text-align: center;
    }

    .dashboard-group {
      margin-top: 8px;
      margin-bottom: 8px;
    }

    .power-characteristic {
      margin: 5px;
    }

    .status-indicator {
      display: inline-block;
      height: 1em;
      width: 1em;
      border-radius: 50%;
      margin-left: 0.25em;
      margin-right: 0.25em;
    }

    .indicator {
      display: inline-block;
      width: 20%;
      margin-right: 2.5%;
    }

    .valuebar {
      min-width: 100px;
      height: 8px;
      background-color: #9a9a9a;
    }

    .valuebar-inner {
      height: 100%;
      width: 0%;
      float: left;
    }

    .overvaluebar-inner {
      height: 100%;
      width: 0%;
      float: left;
    }

    .overvaluebar2-inner {
      height: 100%;
      width: 0%;
      float: left;
    }

    .ubz-number-input {
      width: 4em;
    }

    .substrate {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 50;
      background-color: #1c1c1c7f;
      display: none;
    }

    .popup-menu {
      position: absolute;
      left: 25%;
      top: 25%;
      min-width: 450px;
      width: 50%;
      z-index: 100;
      background-color: whitesmoke;
      display: none;
      text-align: left;
    }

    .popup-header-background {
      padding-right: 10px;
    }

    .popup-footer-background {
      padding-top: 5px;
      padding-bottom: 10px;
      padding-left: 10px;
    }

    .close-button {
      float: right;
      margin-right: 10px;
    }

    .settings-list {
      width: 100%;
      table-layout: fixed;
    }

    .dashboard-spinner-overlay {
      position: absolute;
      left: 50%;
      top: 50%;
      z-index: 60;
    }

    .spinner-invisible {
      display: none;
    }

    #popup-menu-items {
      overflow: auto;
      max-height: 400px;
      background-color: white;
      padding-left: 10px;
      padding-right: 0;
    }

    .ubz-params-input-area {
      width: 9em;
    }

    .ubz-mainmenu-parameter-area {
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .ubz-params-input {
      width: 8em;
    }

    .ubz-parameter-description {
      max-width: 75%;
      float: left;
    }

    .ubz-value {
      float: right;
    }

    .ubz-value-text {
      color: #909090;
    }

    .ubz-input {
      width: 8em;
    }

    .ubz-parameters-menu-section {
      padding-top: 10px;
    }

    .ubz-parameters-menu-summary {
      padding-top: 5px;
      max-width: 90%;
      overflow-wrap: break-word;
    }

    #heating-graph {
      border: 1px solid lightslategrey;
      background-color: white;
      width: 240px;
    }

    .btn-vis {
      background-color: #1e8bc3;
      color: white;
    }

    .btn-pulse {
      animation: pulse-anim 1s infinite alternate ease-in-out;
    }

    @keyframes pulse-anim {
      100% {
        filter: brightness(150%);
      }
    }

    .faults-table {
      width: 100%;
    }

    .faults-table tbody {
      background-color: transparent;
      max-height: 100%;
      min-width: 100%;
    }

    .faults-table thead tr {
      height: 1.5em;
    }

    .faults-table th {
      text-align: center;
      padding: 4px;
      border: 3px solid transparent;
      background-color: whitesmoke;
      height: 1.5em;
      position: sticky;
      top: 0;
    }

    .faults-table td {
      height: 1.5em;
      text-align: center;
      padding: 4px;
      border: 3px solid transparent;
    }

    #dashboard-table-currents tbody {
      height: 6em;
    }

    #narrow-screen-hack {
      display: none;
    }

    @media only screen and (max-device-width: 1440px) {
      .power-characteristic {
        padding: 10px;
      }

      .popup-menu {
        position: absolute;
        left: 0%;
        top: 25%;
        z-index: 100;
        background-color: whitesmoke;
        display: none;
        text-align: left;
        min-width: none;
        max-width: 90%;
      }

      .settings-list {
        width: 90%;
      }

      .ubz-parameters-menu-summary {
        max-width: 90%;
        overflow-wrap: break-word;
      }

      #narrow-screen-hack {
        display: block;
        margin-top: 5px;
      }
    }
  </style>

  <div id="ubz-vis-container">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <h2 id="ubz-302-header">UBZ-302 Control Panel</h2>
    <div style="text-align: left;" id="session-time">Session time: </div>

    <div class="container dashboard-container">
      <div class="row">
        <div class="col-sm">
          <header class="dashboard-header">
            <span id="ubz-status-text">UBZ Status</span>
            <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
          </header>
          <div class="dashboard-group">
            <div><span class="status-indicator bg-success"></span><span id="mmsp-mode-text">MMSP</span></div>
            <div><span class="status-indicator bg-success"></span><span id="functional-relay-mode-text">Functional relay</span>
            </div>
            <div><span class="status-indicator bg-success"></span><span id="motor-relay-mode-text">Motor relay</span></div>
          </div>
          <div class="dashboard-group">
            <header class="dashboard-header">
              <span id="functional-relay-work-mode-text">Functional relay work mode</span>
              <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
            </header>
            <form id="functional-relay-work-mode-radio">
              <input type="radio" id="radio-workmode-alarm" name="func-relay-workmode" value="alarmrelay">
              <label for="radio-workmode-alarm"><span id="radio-workmode-alarm-text">Alarm relay</span></label><br>
              <input type="radio" id="radio-workmode-time" name="func-relay-workmode" value="timerelay">
              <label for="radio-workmode-time"><span id="radio-workmode-time-text">Time relay</span></label><br>
              <input type="radio" id="radio-workmode-stardelta" name="func-relay-workmode" value="stardelta">
              <label for="radio-workmode-stardelta"><span id="radio-workmode-stardelta-text">Star / delta</span></label><br>
            </form>
            <div class="ubz-mainmenu-parameter-area"> <span id="ct-in-use-text">CT in use</span>

              <span class="ubz-value">
                <span class="spinner-border spinner-border-sm init-reading-spinner" role="status"></span>
                <select class="ubz-input" id="CT-in-use">
                  <option value="integrated-CT" id="integrated-ct-text">Integrated CT</option>
                  <option value="external-CT" id="external-ct-text">External CT</option>
                </select>
              </span>
            </div>
            <div class="ubz-mainmenu-parameter-area"><span id="for-external-ct-text">For external CT</span>
              <span class="ubz-value">
                <span class="spinner-border spinner-border-sm init-reading-spinner" role="status"></span>
                <span>
                  <input class="ubz-input" type="number" value="100" min="20" max="800" id="external-ct-current">
                </span>
              </span>
            </div>
            <div class="ubz-mainmenu-parameter-area"><span id="motor-rated-current-text">Motor rated current</span>
              <span class="ubz-value">
                <span class="spinner-border spinner-border-sm init-reading-spinner" role="status"></span>
                <span>
                  <input class="ubz-input" type="number" value="0" min="0" max="630" id="motor-rated-current">
                </span>
              </span>
            </div>
          </div>

          <div class="dashboard-group">
            <details>
              <summary class="additional-drop-down-block">Additional</summary>
              <div><span id="sensor-1-temperature-text">Sensor 1 temperature: </span><span id="sensor-1-temperature-value"
                  class="ubz-value ubz-value-text ubz-off-text">Off</span>
              </div>
              <div><span id="sensor-2-temperature-text">Sensor 2 temperature: </span><span id="sensor-2-temperature-value"
                  class="ubz-value ubz-value-text ubz-off-text">Off</span>
              </div>
              <div><span id="current-input-text">Current input: </span><span id="current-input-value" class="ubz-value ubz-value-text">0.0</span> <span
                  class="ubz-value-text" id="ubz-ma-text">mA</span></div>
              <div><span id="analog-input-text">Analog input: </span><span id="analog-input-value" class="ubz-value ubz-value-text">0.0</span> <span
                  class="ubz-value-text volts-text">V</span></div>
              <div><span id="frequency-text">Frequency: </span><span id="frequency-value" class="ubz-value ubz-value-text">50.0</span> <span
                  class="ubz-value-text">Hz</span></div>
              <div><span id="insulation-resistance-text">Insulation resistance: </span><span id="insulation-resistance-value"
                  class="ubz-value ubz-value-text">20.0</span>
                <span class="ubz-value-text" id="ubz-mohm-text">MOhm</span>
              </div>
            </details>
          </div>

          <div class="dashboard-group"><button type="button" class="btn btn-vis" id="motor-start-stop-button"
              disabled>Automatic mode</button></div>
          <div class="dashboard-group">
            <button type="button" class="btn btn-vis" id="save-file-button">
              <span class="spinner-border spinner-border-sm spinner-invisible" role="status" aria-hidden="true"
                id="save-file-button-spinner"></span>
              <span id="log-event-ubz-text">Log event UBZ</span>
            </button>
            <button type="button" class="btn btn-vis" id="ubz-parameters-button">UBZ Parameters</button>
          </div>
        </div>
        <div class="col-sm">
          <header class="dashboard-header" id="header-ubz-fault-status">UBZ Fault Status</header>

          <div class="dashboard-group">
            <div style="margin: 10px; text-align: center;">
              <div class="indicator bg-danger" id="fault-indicator">Fault</div>
              <div class="indicator bg-warning" id="ext-in-indicator">Ext. in.</div>
              <div class="indicator bg-success" id="ar-indicator">AR</div>
              <div class="indicator bg-info" id="rc-indicator">RC</div>
            </div>


            <div style="margin: 10px; text-align: center;">
              <button type="button" class="btn btn-vis" id="reset-fault-button">
                <span class="spinner-border spinner-border-sm spinner-invisible" role="status" aria-hidden="true"
                  id="reset-fault-button-spinner"></span>
                <span id="reset-fault-text">Reset Fault</span>
              </button>
            </div>


          </div>
          <div class="dashboard-group" style="overflow-y: auto; max-height: 320px;">
            <table class="faults-table">
              <thead id="faults-table-head">
                <colgroup>
                  <col span="1" style="width: 30%">
                  <col span="1" style="width: 15%">
                  <col span="1" style="width: 25%">
                  <col span="1" style="width: 30%">
                </colgroup>
                <tr>
                  <th id="table-header-name">
                    Name
                  </th>
                  <th>
                    ###
                  </th>
                  <th id="table-header-value">
                    Value
                  </th>
                  <th id="table-header-time">
                    Time
                  </th>
                </tr>
              </thead>
              <tbody id="faults-table-body"></tbody>
            </table>
          </div>
        </div>
        <div class="col-sm">
          <header class="dashboard-header" id="header-graphs">Graphs</header>
          <div class="dashboard-group">
            <div id="div-heating-graph" style="display: none;">
              <canvas id="heating-graph">Your browser does not support the canvas element.</canvas>
            </div>
          </div>

          <div class="dashboard-group">
            <div class="form-check">
              <input type="checkbox" id="minutes-voltage-graph" checked>
              <label class="form-check-label" for="minutes-voltage-graph" id="minutes-voltages-graph-scale-text">
                Minutes voltages graph scale
              </label>
              <span class="spinner-border spinner-border-sm init-graph-spinner" role="status"></span>
            </div>

            <div id="div-voltage-phases-graph" style="display: none;">
              <canvas id="voltage-phases-graph">Your browser does not support the canvas element.</canvas>
            </div>
            <div id="div-voltage-phases-graph-m">
              <canvas id="voltage-phases-graph-m">Your browser does not support the canvas element.</canvas>
            </div>
          </div>

          <div class="dashboard-group">
            <div class="form-check">
              <input type="checkbox" id="minutes-amperage-graph" checked>
              <label class="form-check-label" for="minutes-amperage-graph" id="minutes-amperages-graph-scale-text">
                Minutes currents graph scale
              </label>
              <span class="spinner-border spinner-border-sm init-graph-spinner" role="status"></span>
            </div>

            <div id="div-amperage-phases-graph" style="display: none;">
              <canvas id="amperage-phases-graph">Your browser does not support the canvas element.</canvas>
            </div>
            <div id="div-amperage-phases-graph-m">
              <canvas id="amperage-phases-graph-m">Your browser does not support the canvas element.</canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm">
          <header class="dashboard-header" id="header-current-ampere">Current (Ampere)</header>
          <div class="dashboard-group">
            <p id="phase-currents-active-values-text">Phase currents active values:</p>
            <div><span class="phase-1-text">Phase 1: </span><div class="valuebar" id="phase-1-current-rms-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-1-current-rms-bar-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-1-current-rms-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text">A</span>
            </div>
            <div><span class="phase-2-text">Phase 2: </span><div class="valuebar" id="phase-2-current-rms-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-2-current-rms-bar-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-2-current-rms-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text">A</span>
            </div>
            <div><span class="phase-3-text">Phase 3: </span><div class="valuebar" id="phase-3-current-rms-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-3-current-rms-bar-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-3-current-rms-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text">A</span>
            </div>
          </div>
          <div class="dashboard-group">
            <details>
              <summary class="additional-drop-down-block">Additional</summary>
              <div class="dashboard-group">
                <div>
                  <p id="negative-sequence-current-text">Negative sequence current:</p>
                  <div class="valuebar" id="negative-sequence-current-bar" value="0">
                    <div class="valuebar-inner bg-success" id="negative-sequence-current-bar-inner">
                    </div>
                  </div> <span id="negative-sequence-current-value" class="ubz-value-text">0.0</span> <span
                    class="ubz-value-text">A</span>
                </div>
                <div>
                  <p id="zero-sequence-current-text">Zero sequence current:</p>
                  <div class="valuebar" id="zero-sequence-current-bar" value="0">
                    <div class="valuebar-inner bg-success" id="zero-sequence-current-bar-inner"></div>
                  </div> <span id="zero-sequence-current-value" class="ubz-value-text">0.0</span> <span
                    class="ubz-value-text">A</span>
                </div>
              </div>

              <div class="dashboard-group">
                <table id="dashboard-table-currents">
                  <tr>
                    <th colspan="2" id="current-average-value-text">Current average value:</th>
                    <th id="for-time-text">For time:</th>
                    <th id="max-text">Max:</th>
                  </tr>
                  <tr>
                    <td class="phase-1-text">Phase 1:</td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="avg-current-value-phase-1" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                    <td rowspan="3">
                      <span id="current-average-for-time-value" class="ubz-value-text">60.0</span> <span
                        class="ubz-value-text ubz-sec-text">sec</span>
                    </td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="max-current-value-phase-1" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="phase-2-text">Phase 2:</td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="avg-current-value-phase-2" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="max-current-value-phase-2" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                  </tr>
                  <tr>
                    <td class="phase-3-text">Phase 3:</td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="avg-current-value-phase-3" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                    <td><span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                      <span id="max-current-value-phase-3" class="ubz-value-text">0.0</span> <span
                        class="ubz-value-text">A</span>
                    </td>
                  </tr>
                </table>
              </div>

              <div class="dashboard-group">
                <div><span id="motor-start-current-text">Motor start current: </span><span class="spinner-border spinner-border-sm reading-process-spinner"
                    role="status"></span> <span id="motor-start-current-value" class="ubz-value-text">0.0</span> <span
                    class="ubz-value-text">A</span></div>
                <div><span id="overload-current-text">Overload current: </span><span class="spinner-border spinner-border-sm reading-process-spinner"
                    role="status"></span> <span id="overload-current-value" class="ubz-value-text">0.0</span> <span
                    class="ubz-value-text">A</span></div>
              </div>

            </details>
          </div>
        </div>
        <div class="col-sm">
          <header class="dashboard-header" id="header-voltage-volt">Voltage (Volt)</header>
          <div class="dashboard-group">
            <p id="phase-voltages-active-values-text">Phase voltages active values:</p>
            <div> <span class="phase-1-text">Phase 1: </span><div class="valuebar" id="phase-1-voltage-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-1-voltage-bar-inner"></div>
                <div class="overvaluebar-inner bg-warning" id="phase-1-voltage-bar-over-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-1-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span></div>
            <div> <span class="phase-2-text">Phase 2: </span><div class="valuebar" id="phase-2-voltage-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-2-voltage-bar-inner"></div>
                <div class="overvaluebar-inner bg-warning" id="phase-2-voltage-bar-over-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-2-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span></div>
            <div> <span class="phase-3-text">Phase 3: </span><div class="valuebar" id="phase-3-voltage-bar" value="0">
                <div class="valuebar-inner bg-success" id="phase-3-voltage-bar-inner"></div>
                <div class="overvaluebar-inner bg-warning" id="phase-3-voltage-bar-over-inner"></div>
              </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                id="phase-3-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span></div>
          </div>
          <div class="dashboard-group">
            <details>
              <summary class="additional-drop-down-block">Additional</summary>
              <div>
                <p id="line-voltages-active-values-text">Line voltages active values:</p>
                <div>AB:
                  <div class="valuebar" id="line-1-voltage-bar" value="0">
                    <div class="valuebar-inner bg-success" id="line-1-voltage-bar-inner"></div>
                    <div class="overvaluebar-inner bg-warning" id="line-1-voltage-bar-over-inner">
                    </div>
                    <div class="overvaluebar2-inner bg-danger" id="line-1-voltage-bar-over2-inner">
                    </div>
                  </div>
                  <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    id="line-1-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span>
                </div>
                <div>BC:
                  <div class="valuebar" id="line-2-voltage-bar" value="0">
                    <div class="valuebar-inner bg-success" id="line-2-voltage-bar-inner"></div>
                    <div class="overvaluebar-inner bg-warning" id="line-2-voltage-bar-over-inner">
                    </div>
                    <div class="overvaluebar2-inner bg-danger" id="line-2-voltage-bar-over2-inner">
                    </div>
                  </div>
                  <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    id="line-2-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span>
                </div>
                <div>CA:
                  <div class="valuebar" id="line-3-voltage-bar" value="0">
                    <div class="valuebar-inner bg-success" id="line-3-voltage-bar-inner"></div>
                    <div class="overvaluebar-inner bg-warning" id="line-3-voltage-bar-over-inner">
                    </div>
                    <div class="overvaluebar2-inner bg-danger" id="line-3-voltage-bar-over2-inner">
                    </div>
                  </div>
                  <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    id="line-3-voltage-value" class="ubz-value-text">0.0</span> <span class="ubz-value-text volts-text">V</span>
                </div>
              </div>
              <p>
                <span id="negative-sequence-voltage-text">Negative sequence voltage:</span>
                
              <div>
                <div class="valuebar" id="negative-sequence-voltage-bar" value="0">
                  <div class="valuebar-inner bg-success" id="negative-sequence-voltage-bar-inner"></div>
                </div> <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                <span id="negative-sequence-voltage-value" class="ubz-value-text">0.0</span> <span
                  class="ubz-value-text volts-text">V</span>
              </div>
              </p>
              <p>
                <span id="positive-sequence-voltage-text">Positive sequence voltage: </span>
                <span class="spinner-border spinner-border-sm reading-process-spinner"
                  role="status"></span>
                <span id="positive-sequence-voltage-value" class="ubz-value-text">0</span> <span
                  class="ubz-value-text volts-text">V</span>
              </p>
              <p>
                <span id="zero-sequence-voltage-text">Zero sequence voltage: </span>
                <span class="spinner-border spinner-border-sm reading-process-spinner"
                  role="status"></span>
                <span id="zero-sequence-voltage-value" class="ubz-value-text">0</span> <span
                  class="ubz-value-text volts-text">V</span>
              </p>
            </details>
          </div>
        </div>
        <div class="col-sm">
          <header class="dashboard-header" id="header-time-sec">Time (sec)</header>
          <div class="dashboard-group">
            <p id="time-before-ar-text">Time before AR:</p>
            <div class="valuebar" id="time-before-ar-bar" value="0">
              <div class="valuebar-inner bg-success" id="time-before-ar-bar-inner"></div>
            </div>
            <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
              id="time-before-ar-string" class="ubz-value-text ubz-off-text"> Off</span>
          </div>
          <div class="dashboard-group">
            <details>
              <summary class="additional-drop-down-block">Additional</summary>

              <div><span id="startup-time-text">Startup time:</span> <span class="ubz-value"><span
                    class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    class="ubz-value-text" id="startup-time-value">0</span> <span
                    class="ubz-value-text ubz-sec-text">sec</span></span></div>
              <div> <span id="time-before-overload-tripping-text">Time before overload tripping:</span>
                <span class="ubz-value">
                  <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    id="time-before-overload-tripping-string" class="ubz-value-text ubz-no-text">No</span>
                </span>
              </div>
              <div> <span id="wait-time-after-overload-deenergize-text">Wait time after overload deenergize:</span>
                <span class="ubz-value">
                  <span class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span> <span
                    id="wait-time-after-overload-deenergize-string" class="ubz-value-text ubz-no-text">No</span>
              </div>
              </span>
            </details>
          </div>

          <div class="dashboard-group">
            <header class="dashboard-header" id="header-power">Power</header>
            <div><span id="full-power-text">Full power: </span> <span class="ubz-value"><span
                  class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                <span id="full-power-value" class="ubz-value-text">-</span></span></div>
            <div><span id="active-power-text">Active power: </span> <span class="ubz-value"><span
                  class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                <span id="active-power-value" class="ubz-value-text">-</span></span></div>
            <div><span id="reactive-power-text">Reactive power: </span> <span class="ubz-value"><span
                  class="spinner-border spinner-border-sm reading-process-spinner" role="status"></span>
                <span id="reactive-power-value" class="ubz-value-text">-</span></span></div>
            <div>
              <select id="power-characteristic-value-1" class="power-characteristic"
                name="power-characteristic-value-1">
                <option value="no-selection" class="no-selection-text"> -select- </option>
                <option value="phase-1-full-power" class="phase-1-full-power-text">Phase 1 full power</option>
                <option value="phase-2-full-power" class="phase-2-full-power-text">Phase 2 full power</option>
                <option value="phase-3-full-power" class="phase-3-full-power-text">Phase 3 full power</option>
                <option value="phase-1-active-power" class="phase-1-active-power-text">Phase 1 active power</option>
                <option value="phase-2-active-power" class="phase-2-active-power-text">Phase 2 active power</option>
                <option value="phase-3-active-power" class="phase-3-active-power-text">Phase 3 active power</option>
                <option value="phase-1-reactive-power" class="phase-1-reactive-power-text">Phase 1 reactive power</option>
                <option value="phase-2-reactive-power" class="phase-2-reactive-power-text">Phase 2 reactive power</option>
                <option value="phase-3-reactive-power" class="phase-3-reactive-power-text">Phase 3 reactive power</option>
                <option value="phase-1-cos-phi" class="phase-1-cos-phi-text">Phase 1 cos Phi</option>
                <option value="phase-2-cos-phi" class="phase-2-cos-phi-text">Phase 2 cos Phi</option>
                <option value="phase-3-cos-phi" class="phase-3-cos-phi-text">Phase 3 cos Phi</option>
              </select>
              <span id="power-show-value-1" class="ubz-value ubz-value-text">
                -
              </span>
            </div>
            <div>
              <select id="power-characteristic-value-2" class="power-characteristic"
                name="power-characteristic-value-2">
                <option value="no-selection" class="no-selection-text"> -select- </option>
                <option value="phase-1-full-power" class="phase-1-full-power-text">Phase 1 full power</option>
                <option value="phase-2-full-power" class="phase-2-full-power-text">Phase 2 full power</option>
                <option value="phase-3-full-power" class="phase-3-full-power-text">Phase 3 full power</option>
                <option value="phase-1-active-power" class="phase-1-active-power-text">Phase 1 active power</option>
                <option value="phase-2-active-power" class="phase-2-active-power-text">Phase 2 active power</option>
                <option value="phase-3-active-power" class="phase-3-active-power-text">Phase 3 active power</option>
                <option value="phase-1-reactive-power" class="phase-1-reactive-power-text">Phase 1 reactive power</option>
                <option value="phase-2-reactive-power" class="phase-2-reactive-power-text">Phase 2 reactive power</option>
                <option value="phase-3-reactive-power" class="phase-3-reactive-power-text">Phase 3 reactive power</option>
                <option value="phase-1-cos-phi" class="phase-1-cos-phi-text">Phase 1 cos Phi</option>
                <option value="phase-2-cos-phi" class="phase-2-cos-phi-text">Phase 2 cos Phi</option>
                <option value="phase-3-cos-phi" class="phase-3-cos-phi-text">Phase 3 cos Phi</option>
              </select>
              <span id="power-show-value-2" class="ubz-value ubz-value-text">
                -
              </span>
            </div>
            <div>
              <select id="power-characteristic-value-3" class="power-characteristic"
                name="power-characteristic-value-3">
                <option value="no-selection" class="no-selection-text"> -select- </option>
                <option value="phase-1-full-power" class="phase-1-full-power-text">Phase 1 full power</option>
                <option value="phase-2-full-power" class="phase-2-full-power-text">Phase 2 full power</option>
                <option value="phase-3-full-power" class="phase-3-full-power-text">Phase 3 full power</option>
                <option value="phase-1-active-power" class="phase-1-active-power-text">Phase 1 active power</option>
                <option value="phase-2-active-power" class="phase-2-active-power-text">Phase 2 active power</option>
                <option value="phase-3-active-power" class="phase-3-active-power-text">Phase 3 active power</option>
                <option value="phase-1-reactive-power" class="phase-1-reactive-power-text">Phase 1 reactive power</option>
                <option value="phase-2-reactive-power" class="phase-2-reactive-power-text">Phase 2 reactive power</option>
                <option value="phase-3-reactive-power" class="phase-3-reactive-power-text">Phase 3 reactive power</option>
                <option value="phase-1-cos-phi" class="phase-1-cos-phi-text">Phase 1 cos Phi</option>
                <option value="phase-2-cos-phi" class="phase-2-cos-phi-text">Phase 2 cos Phi</option>
                <option value="phase-3-cos-phi" class="phase-3-cos-phi-text">Phase 3 cos Phi</option>
              </select>
              <span id="power-show-value-3" class="ubz-value ubz-value-text">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="substrate" id="substrate-popup-menu"></div>

    <div class="popup-menu" id="ubz-parameters-menu">
      <div class="popup-header-background">
        <button type="button" class="close close-button" aria-label="Close" id="ubz-parameters-close"><span
            aria-hidden="true">&times;</span></button>
        <header class="ubz-parameters-header" id="ubz-parameters-header-text">UBZ parameters menu</header>
      </div>

      <div id="popup-menu-items">
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-transformers">Transformers</summary>
          <table class="settings-list" style="height: 4em;">
            <tr>
              <td id="ubz-setting-150-text">
                [150] tPt: CT in use
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-150">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-151-text">
                [151] tnt: CT rated current, A
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="20" max="800" value="100" id="ubz-param-input-151">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-miscellaneous">Miscellaneous</summary>
          <table class="settings-list" style="height: 4em;">
            <tr>
              <td id="ubz-setting-152-text">
                [152] ind: Motor rated current, A
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="630" value="0" id="ubz-param-input-152">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-153-text">
                [153] tSi: Average current measurement time, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="10" max="600" value="60" id="ubz-param-input-153">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-overcurrent-protection">Overcurrent protection</summary>
          <table class="settings-list" style="height: 10em;">
            <tr>
              <td id="ubz-setting-154-text">
                [154] i^P: Overcurrent protection type
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="5" value="0" id="ubz-param-input-154">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-155-text">
                [155] i^S: Overcurrent protection tripping setting value, ratio
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.8" max="9.0" value="4.0" step="0.1"
                  id="ubz-param-input-155">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-156-text">
                [156] i^t: Overcurrent protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.3" max="600" value="10" step="0.1"
                  id="ubz-param-input-156">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-157-text">
                [157] i^r: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <div class="ubz-parameter-description"></div><input type="number" class="ubz-params-input" min="0"
                  max="2" value="2" id="ubz-param-input-157">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-158-text">
                [158] i^n: Order of overcurrent protection tripping relative to thermal overload protection
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-158">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-protection-against-ground-faults">Protection against ground faults</summary>
          <table class="settings-list" style="height: 6em;">
            <tr>
              <td id="ubz-setting-159-text">
                [159] i_S: Current fault tripping setting, A
              </td>
              <td class="ubz-params-input-area">
                <div>
                  <input type="number" class="ubz-params-input" min="0.3" max="5.0" value="0.5" step="0.1"
                    id="ubz-param-input-159">
                </div>
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-160-text">
                [160] i_t: Protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.3" max="2.0" value="1.0" step="0.1"
                  id="ubz-param-input-160">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-161-text">
                [161] i_r: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-161">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-negative-sequence-current-protection">Negative sequence current protection</summary>
          <table class="settings-list" style="height: 6em;">
            <tr>
              <td id="ubz-setting-162-text">
                [162] ioS: Tripping setting, %
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="5" max="20" value="10" id="ubz-param-input-162">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-163-text">
                [163] iot: Protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.3" max="10" value="5" step="0.1"
                  id="ubz-param-input-163">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-164-text">
                [164] ior: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-164">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-analysis-of-causes">Analysis of causes for negative sequence current protection
            tripping</summary>
          <table class="settings-list" style="height: 4em;">
            <tr>
              <td id="ubz-setting-165-text">
                [165] iOS: Negative sequence current ratio divided by negative sequence voltage ratio
              </td>
              <td class="ubz-params-input-area">
                <div class="ubz-parameter-description"></div><input type="number" class="ubz-params-input" min="2"
                  max="4" value="2" id="ubz-param-input-165">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-166-text">
                [166] iOr: Analysis permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-166">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-thermal-overload">Thermal overload (motor thermal model)</summary>
          <table class="settings-list" style="height: 6em;">
            <tr>
              <td id="ubz-setting-167-text">
                [167] dtr: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-167">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-168-text">
                [168] dtt: Double overcurrent overload protection tripping time, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="10" max="120" value="60" id="ubz-param-input-168">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-169-text">
                [169] dtP: Time increase ratio with a stopped motor
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="4" value="1" step="0.1"
                  id="ubz-param-input-169">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-undercurrent-phase">Undercurrent phase protection</summary>
          <table class="settings-list" style="height: 6em;">
            <tr>
              <td id="ubz-setting-170-text">
                [170] i=S: Tripping setting, %
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="11" max="90" value="20" id="ubz-param-input-170">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-171-text">
                [171] i=t: Protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="100" value="5" id="ubz-param-input-171">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-172-text">
                [172] i=r: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-172">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-delayed-start">Delayed start, rotor blocking</summary>
          <table class="settings-list" style="height: 8em;">
            <tr>
              <td id="ubz-setting-173-text">
                [173] PPS: Tripping setting, ratio
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1.5" max="7" value="5" step="0.1"
                  id="ubz-param-input-173">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-174-text">
                [174] PPt: Delayed start protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="600" value="10" id="ubz-param-input-174">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-175-text">
                [175] Pbt: Rotor blocking protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.3" max="300" value="1" step="0.1"
                  id="ubz-param-input-175">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-176-text">
                [176] PPr: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="1" id="ubz-param-input-176">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-voltage-protection">Voltage protection</summary>
          <table class="settings-list" style="height: 20em;">
            <tr>
              <td id="ubz-setting-177-text">
                [177] U=S: Minimum line voltage, V
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="270" max="415" value="320" id="ubz-param-input-177">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-178-text">
                [178] U=t: Minimum voltage protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="5" max="30" value="10" id="ubz-param-input-178">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-179-text">
                [179] U=r: Minimum voltage protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-179">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-180-text">
                [180] U^S: Maximum line voltage, V
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="330" max="475" value="415" id="ubz-param-input-180">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-181-text">
                [181] U^t: Maximum voltage protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="10" value="2" id="ubz-param-input-181">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-182-text">
                [182] U^r: Maximum voltage protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="2" id="ubz-param-input-182">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-183-text">
                [183] U*S: Line voltage imbalance, V
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="15" max="120" value="35" id="ubz-param-input-183">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-184-text">
                [184] U*t: Line voltage imbalance tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="30" value="5" id="ubz-param-input-184">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-185-text">
                [185] U*r: Line voltage imbalance protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="2" id="ubz-param-input-185">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-186-text">
                [186] Ur: Phase sequence order protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="1" id="ubz-param-input-186">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-motor-operation">Motor operation and automatic reclosing</summary>
          <table class="settings-list" style="height: 10em;">
            <tr>
              <td id="ubz-setting-187-text">
                [187] Atn: ARC time after undercurrent protection tripping, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="900" value="600" id="ubz-param-input-187">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-188-text">
                [188] Att: ARC time, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="900" value="5" id="ubz-param-input-188">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-189-text">
                [189] Arr: ARC prohibition for all faults (except voltage faults)
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-189">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-190-text">
                [190] APd: Motor operation permission after UBZ power-on
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="1" id="ubz-param-input-190">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-191-text">
                [191] ACd: Motor control via UBZ front panel
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="3" value="0" id="ubz-param-input-191">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-temperature-control">Temperature control</summary>
          <table class="settings-list" style="height: 18em;">
            <tr>
              <td id="ubz-setting-192-text">
                [192] C1r: Temperature sensor 1 type and temperature control permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-192">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-193-text">
                [193] C1S: Motor de-energizing temperature
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="100" value="80" id="ubz-param-input-193">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-194-text">
                [194] C1c: Sensor 1 temperature correction
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="-9" max="9" value="0" id="ubz-param-input-194">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-195-text">
                [195] C2r: Temperature sensor 2 type and temperature control permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="3" value="0" id="ubz-param-input-195">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-196-text">
                [196] C2S: Motor de-energizing temperature
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="220" value="180" id="ubz-param-input-196">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-197-text">
                [197] C2A: Warning temperature
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="220" value="170" id="ubz-param-input-197">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-198-text">
                [198] C2c: Sensor 2 temperature correction
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="-9" max="9" value="0" id="ubz-param-input-198">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-199-text">
                [199] CPA: ARC after protection tripping
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="2" value="2" id="ubz-param-input-199">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-200-text">
                [200] CCr: Reaction to temperaturesensor failure
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-200">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-motor-insulation">Motor insulation resistance</summary>
          <table class="settings-list" style="height: 2em;">
            <tr>
              <td id="ubz-setting-201-text">
                [201] rid: Minimum motor insulation resistance
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="20" value="5" step="5"
                  id="ubz-param-input-201">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-miscellaneous-2">Miscellaneous</summary>
          <table class="settings-list" style="height: 20em;">
            <tr>
              <td id="ubz-setting-202-text">
                [202] Sin: Minimal number of set parameters mode
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-202">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-203-text">
                [203] SiP: Indication on UBZ display before motor power on
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="1" id="ubz-param-input-203">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-204-text">
                [204] SiC: Parameter indication mode
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-204">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-205-text">
                [205] rrS: Functional relay operation mode
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-205">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-206-text">
                [206] rrt: Timer, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="300" value="30" id="ubz-param-input-206">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-207-text">
                [207] tbU: Equipment uptime, days
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="999" value="0" disabled
                  id="ubz-param-input-207">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-208-text">
                [208] tCO: Motor uptime, days
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="999" value="0" disabled
                  id="ubz-param-input-208">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-209-text">
                [209] LOC: User access code
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="9" value="0" disabled
                  id="ubz-param-input-209">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-210-text">
                [210] PAS: Engineer access code
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="999" value="123" disabled
                  id="ubz-param-input-210">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-211-text">
                [211] PPP: Reset to factory settings
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-211">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-serial">Serial interface parameters (RS-485 / RS-232)</summary>
          <table class="settings-list" style="height: 12em;">
            <tr>
              <td id="ubz-setting-212-text">
                [212] rSA: UBZ communication address
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="1" max="247" value="1" disabled
                  id="ubz-param-input-212">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-213-text">
                [213] rSS: Transfer rate
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-213">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-214-text">
                [214] rSP: Adapter reaction to loss of link
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="3" value="0" id="ubz-param-input-214">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-215-text">
                [215] rSO: Response timeout detection, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="120" value="0" id="ubz-param-input-215">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-216-text">
                [216] rPP: UBZ communication via serial channel
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-216">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-217-text">
                [217] rEL: Device version
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="21" max="21" value="21" disabled
                  id="ubz-param-input-217">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-functional-relay">Functional relay mode parameters. Star-delta mode.</summary>
          <table class="settings-list" style="height: 2em;">
            <tr>
              <td id="ubz-setting-218-text">
                [218] Ftt: Switching, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.1" max="2.0" value="0.4" step="0.1"
                  id="ubz-param-input-218">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-motor-phase">Motor phase (phases) loss, with current control</summary>
          <table class="settings-list" style="height: 6em;">
            <tr>
              <td id="ubz-setting-219-text">
                [219] ibt: Phase loss protection tripping delay, seconds
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0.3" max="10" value="0.5" step="0.1"
                  id="ubz-param-input-219">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-220-text">
                [220] ibr: Protection permission
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="1" id="ubz-param-input-220">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-221-text">
                [221] dUd: Remote motor start andstop using the RS-232/RS485 interfaces
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-221">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-0-20ma">0-20 mA analog input operation</summary>
          <table class="settings-list" style="height: 8em;">
            <tr>
              <td id="ubz-setting-222-text">
                [222] Ait: Upper thershold, mA
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="20.0" value="10.0" step="0.1"
                  id="ubz-param-input-222">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-223-text">
                [223] Aib: Lower thershold, mA
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="20.0" value="1.0" step="0.1"
                  id="ubz-param-input-223">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-224-text">
                [224] AiA: Control algorithm
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-224">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-225-text">
                [225] AiE: Fault logging
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-225">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-0-10v">0-10 V analog input operation</summary>
          <table class="settings-list" style="height: 8em;">
            <tr>
              <td id="ubz-setting-226-text">
                [226] AUt: Upper thershold, V
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="10.0" value="5.0" input="0.1"
                  id="ubz-param-input-226">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-227-text">
                [227] AUb: Lower thershold, V
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="10.0" value="1.0" input="0.1"
                  id="ubz-param-input-227">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-228-text">
                [228] AUA: Control algorithm
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="2" value="0" id="ubz-param-input-228">
              </td>
            </tr>
            <tr>
              <td id="ubz-setting-229-text">
                [229] AUE: Fault logging
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="0" id="ubz-param-input-229">
              </td>
            </tr>
          </table>
        </details>
        <details class="ubz-parameters-menu-section">
          <summary class="ubz-parameters-menu-summary" id="ubz-parameters-summary-control">Control of external MS</summary>
          <table class="settings-list" style="height: 2em;">
            <tr>
              <td id="ubz-setting-230-text">
                [230] CCi: Control of external MS working order
              </td>
              <td class="ubz-params-input-area">
                <input type="number" class="ubz-params-input" min="0" max="1" value="1" id="ubz-param-input-230">
              </td>
            </tr>
          </table>
        </details>
      </div>

      <div class="popup-footer-background">
        <div style="margin-top: 0; margin-bottom: 5px;">
          <input type="checkbox" id="checkbox-write-only-modified-ubz-params" checked> <span id="write-only-modified-ubz-params-text">Write only modified
          parameters</span>
          <span class="spinner-border spinner-border-sm spinner-invisible" role="status" aria-hidden="true"
            id="readwrite-params-spinner"></span>
        </div>
        <div>
          <button type="button" class="btn btn-vis" id="button-write-ubz-params">Write parameters to
            device</button>
          <div id="narrow-screen-hack"></div>
          <button type="button" class="btn btn-vis" id="button-read-ubz-params">Read parameters from
            device</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Locale -->
  <script>
    if (VIS_LOCALE_SETTING === "ru_RU") {
      // Translate
      document.querySelector("#ubz-302-header").innerHTML = "  ";
      document.querySelector("#session-time").innerHTML = " : ";
      document.querySelector("#mmsp-mode-text").innerHTML = "";
      document.querySelector("#functional-relay-mode-text").innerHTML = " ";
      document.querySelector("#motor-relay-mode-text").innerHTML = " ";
      document.querySelector("#functional-relay-work-mode-text").innerHTML = "   ";
      document.querySelector("#ubz-status-text").innerHTML = " ";
      document.querySelector("#radio-workmode-alarm-text").innerHTML = " ";
      document.querySelector("#radio-workmode-time-text").innerHTML = " ";
      document.querySelector("#radio-workmode-stardelta-text").innerHTML = " / ";
      document.querySelector("#ct-in-use-text").innerHTML = " ";
      document.querySelector("#integrated-ct-text").innerHTML = " ";
      document.querySelector("#external-ct-text").innerHTML = " ";
      document.querySelector("#for-external-ct-text").innerHTML = "  ";
      document.querySelector("#motor-rated-current-text").innerHTML = "  ";
      document.querySelectorAll(".additional-drop-down-block").forEach((element) => {
        element.innerHTML = "";
      });
      document.querySelector("#sensor-1-temperature-text").innerHTML = "  1: ";
      document.querySelector("#sensor-2-temperature-text").innerHTML = "  2: ";
      document.querySelector("#current-input-text").innerHTML = " :";
      document.querySelector("#analog-input-text").innerHTML = " :";
      document.querySelector("#frequency-text").innerHTML = "";
      document.querySelector("#insulation-resistance-text").innerHTML = " ";
      document.querySelector("#motor-start-stop-button").innerHTML = " ";
      document.querySelector("#log-event-ubz-text").innerHTML = "  ";
      document.querySelector("#header-ubz-fault-status").innerHTML = "  ";
      document.querySelector("#fault-indicator").innerHTML = "";
      document.querySelector("#ext-in-indicator").innerHTML = ". .";
      document.querySelector("#ar-indicator").innerHTML = "";
      document.querySelector("#rc-indicator").innerHTML = "";
      document.querySelector("#reset-fault-text").innerHTML = " ";
      document.querySelector("#table-header-name").innerHTML = "";
      document.querySelector("#table-header-value").innerHTML = "";
      document.querySelector("#table-header-time").innerHTML = "";
      document.querySelector("#header-graphs").innerHTML = "";
      document.querySelector("#minutes-voltages-graph-scale-text").innerHTML = "   ";
      document.querySelector("#minutes-amperages-graph-scale-text").innerHTML = "   ";
      document.querySelector("#header-current-ampere").innerHTML = " ()";
      document.querySelector("#phase-currents-active-values-text").innerHTML = "   :";
      document.querySelectorAll(".phase-1-text").forEach((element) => {
        element.innerHTML = " 1:";
      });
      document.querySelectorAll(".phase-2-text").forEach((element) => {
        element.innerHTML = " 2:";
      });
      document.querySelectorAll(".phase-3-text").forEach((element) => {
        element.innerHTML = " 3:";
      });
      document.querySelector("#negative-sequence-current-text").innerHTML = "  :";
      document.querySelector("#zero-sequence-current-text").innerHTML = "  :";
      document.querySelector("#current-average-value-text").innerHTML = "  :";
      document.querySelector("#for-time-text").innerHTML = " :";
      document.querySelector("#max-text").innerHTML = ":";
      document.querySelectorAll(".ubz-sec-text").forEach((element) => {
        element.innerHTML = "";
      });
      document.querySelector("#motor-start-current-text").innerHTML = "  ";
      document.querySelector("#overload-current-text").innerHTML = " ";
      document.querySelector("#header-voltage-volt").innerHTML = " ()";
      document.querySelector("#phase-voltages-active-values-text").innerHTML = "   :";
      document.querySelector("#line-voltages-active-values-text").innerHTML = "   ";
      document.querySelectorAll(".volts-text").forEach((element) => {
        element.innerHTML = "";
      });
      document.querySelector("#ubz-ma-text").innerHTML = "";
      document.querySelector("#ubz-mohm-text").innerHTML = "";
      document.querySelector("#negative-sequence-voltage-text").innerHTML = "  ";
      document.querySelector("#positive-sequence-voltage-text").innerHTML = "  ";
      document.querySelector("#zero-sequence-voltage-text").innerHTML = "  ";
      document.querySelector("#header-time-sec").innerHTML = " ()";
      document.querySelector("#time-before-ar-text").innerHTML = "  ";
      document.querySelectorAll(".ubz-off-text").forEach((element) => {
        element.innerHTML = "";
      });
      document.querySelector("#startup-time-text").innerHTML = " :";
      document.querySelector("#time-before-overload-tripping-text").innerHTML = "    ";
      document.querySelectorAll(".ubz-no-text").forEach((element) => {
        element.innerHTML = "";
      });
      document.querySelector("#wait-time-after-overload-deenergize-text").innerHTML = "     ";
      document.querySelector("#header-power").innerHTML = "";
      document.querySelector("#full-power-text").innerHTML = " ";
      document.querySelector("#active-power-text").innerHTML = " ";
      document.querySelector("#reactive-power-text").innerHTML = " ";
      document.querySelectorAll(".no-selection-text").forEach((element) => {
        element.innerHTML = "--";
      });
      document.querySelectorAll(".phase-1-full-power-text").forEach((element) => {
        element.innerHTML = " 1  ";
      });
      document.querySelectorAll(".phase-2-full-power-text").forEach((element) => {
        element.innerHTML = " 2  ";
      });
      document.querySelectorAll(".phase-3-full-power-text").forEach((element) => {
        element.innerHTML = " 3  ";
      });
      document.querySelectorAll(".phase-1-active-power-text").forEach((element) => {
        element.innerHTML = " 1  ";
      });
      document.querySelectorAll(".phase-2-active-power-text").forEach((element) => {
        element.innerHTML = " 2  ";
      });
      document.querySelectorAll(".phase-3-active-power-text").forEach((element) => {
        element.innerHTML = " 3  ";
      });
      document.querySelectorAll(".phase-1-reactive-power-text").forEach((element) => {
        element.innerHTML = " 1  ";
      });
      document.querySelectorAll(".phase-2-reactive-power-text").forEach((element) => {
        element.innerHTML = " 2  ";
      });
      document.querySelectorAll(".phase-3-reactive-power-text").forEach((element) => {
        element.innerHTML = " 3  ";
      });
      document.querySelectorAll(".phase-1-cos-phi-text").forEach((element) => {
        element.innerHTML = " 1  ";
      });
      document.querySelectorAll(".phase-2-cos-phi-text").forEach((element) => {
        element.innerHTML = " 2  ";
      });
      document.querySelectorAll(".phase-3-cos-phi-text").forEach((element) => {
        element.innerHTML = " 3  ";
      });
      document.querySelector("#ubz-parameters-button").innerHTML = " ";

      document.querySelector("#ubz-parameters-header-text").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-transformers").innerHTML = "";
      document.querySelector("#ubz-parameters-summary-miscellaneous").innerHTML = "";
      document.querySelector("#ubz-parameters-summary-overcurrent-protection").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-protection-against-ground-faults").innerHTML = "     (    iF0)";
      document.querySelector("#ubz-parameters-summary-negative-sequence-current-protection").innerHTML = "    ";
      document.querySelector("#ubz-parameters-summary-analysis-of-causes").innerHTML = "       ";
      document.querySelector("#ubz-parameters-summary-thermal-overload").innerHTML = "  (  )";
      document.querySelector("#ubz-parameters-summary-undercurrent-phase").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-delayed-start").innerHTML = " ,  ";
      document.querySelector("#ubz-parameters-summary-voltage-protection").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-motor-operation").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-temperature-control").innerHTML = " ";
      document.querySelector("#ubz-parameters-summary-motor-insulation").innerHTML = "  ";
      document.querySelector("#ubz-parameters-summary-miscellaneous-2").innerHTML = "";
      document.querySelector("#ubz-parameters-summary-serial").innerHTML = "   (RS-485 / RS-232)";
      document.querySelector("#ubz-parameters-summary-functional-relay").innerHTML = "   .  -";
      document.querySelector("#ubz-parameters-summary-motor-phase").innerHTML = "  ()     ";
      document.querySelector("#ubz-parameters-summary-0-20ma").innerHTML = "    0-20 ";
      document.querySelector("#ubz-parameters-summary-0-10v").innerHTML = "    0-10";
      document.querySelector("#ubz-parameters-summary-control").innerHTML = "   ";
      document.querySelector("#button-write-ubz-params").innerHTML = "    ";
      document.querySelector("#button-read-ubz-params").innerHTML = "    ";
      document.querySelector("#write-only-modified-ubz-params-text").innerHTML = "    ";

      document.querySelector("#ubz-setting-150-text").innerHTML = "[150] tPt:  ";
      document.querySelector("#ubz-setting-151-text").innerHTML = "[151] tnt:   , ";
      document.querySelector("#ubz-setting-152-text").innerHTML = "[152] ind:   , ";
      document.querySelector("#ubz-setting-153-text").innerHTML = "[153] tSi: ,      , ";
      document.querySelector("#ubz-setting-154-text").innerHTML = "[154] i^P:    ";
      document.querySelector("#ubz-setting-155-text").innerHTML = "[155] i^S:      , ";
      document.querySelector("#ubz-setting-156-text").innerHTML = "[156] i^t:     , ";
      document.querySelector("#ubz-setting-157-text").innerHTML = "[157] i^r:   ";
      document.querySelector("#ubz-setting-158-text").innerHTML = "[158] i^n:       ";
      document.querySelector("#ubz-setting-159-text").innerHTML = "[159] i_S:    , ";
      document.querySelector("#ubz-setting-160-text").innerHTML = "[160] i_t:   , ";
      document.querySelector("#ubz-setting-161-text").innerHTML = "[161] i_r:   ";
      document.querySelector("#ubz-setting-162-text").innerHTML = "[162] ioS:  , %";
      document.querySelector("#ubz-setting-163-text").innerHTML = "[163] iot:   , ";
      document.querySelector("#ubz-setting-164-text").innerHTML = "[164] ior:   ";
      document.querySelector("#ubz-setting-165-text").innerHTML = "[165] iOS:             ";
      document.querySelector("#ubz-setting-166-text").innerHTML = "[166] iOr:  ";
      document.querySelector("#ubz-setting-167-text").innerHTML = "[167] dtr:   ";
      document.querySelector("#ubz-setting-168-text").innerHTML = "[168] dtt:        , ";
      document.querySelector("#ubz-setting-169-text").innerHTML = "[169] dtP:      ";
      document.querySelector("#ubz-setting-170-text").innerHTML = "[170] i=S:  , %";
      document.querySelector("#ubz-setting-171-text").innerHTML = "[171] i=t:   , ";
      document.querySelector("#ubz-setting-172-text").innerHTML = "[172] i=r:   ";
      document.querySelector("#ubz-setting-173-text").innerHTML = "[173] PPS:  , ";
      document.querySelector("#ubz-setting-174-text").innerHTML = "[174] PPt:      , ";
      document.querySelector("#ubz-setting-175-text").innerHTML = "[175] Pbt:      , ";
      document.querySelector("#ubz-setting-176-text").innerHTML = "[176] PPr:   ";
      document.querySelector("#ubz-setting-177-text").innerHTML = "[177] U=S:   , ";
      document.querySelector("#ubz-setting-178-text").innerHTML = "[178] U=t:  o   , ";
      document.querySelector("#ubz-setting-179-text").innerHTML = "[179] U=r:      ";
      document.querySelector("#ubz-setting-180-text").innerHTML = "[180] U^S:   , ";
      document.querySelector("#ubz-setting-181-text").innerHTML = "[181] U^t:       , ";
      document.querySelector("#ubz-setting-182-text").innerHTML = "[182] U^r:      ";
      document.querySelector("#ubz-setting-183-text").innerHTML = "[183] U*S:   , ";
      document.querySelector("#ubz-setting-184-text").innerHTML = "[184] U*t:       , c";
      document.querySelector("#ubz-setting-185-text").innerHTML = "[185] U*r:       ";
      document.querySelector("#ubz-setting-186-text").innerHTML = "[186] Ur:       ";
      document.querySelector("#ubz-setting-187-text").innerHTML = "[187] Atn:        , ";
      document.querySelector("#ubz-setting-188-text").innerHTML = "[188] Att:  , ";
      document.querySelector("#ubz-setting-189-text").innerHTML = "[189] Arr:      (   )";
      document.querySelector("#ubz-setting-190-text").innerHTML = "[190] APd:        ";
      document.querySelector("#ubz-setting-191-text").innerHTML = "[191] ACd:      ";
      document.querySelector("#ubz-setting-192-text").innerHTML = "[192] C1r:        1";
      document.querySelector("#ubz-setting-193-text").innerHTML = "[193] C1S:   ";
      document.querySelector("#ubz-setting-194-text").innerHTML = "[194] C1c:    ";
      document.querySelector("#ubz-setting-195-text").innerHTML = "[195] C2r:        2";
      document.querySelector("#ubz-setting-196-text").innerHTML = "[196] C2S:   ";
      document.querySelector("#ubz-setting-197-text").innerHTML = "[197] C2A:  ";
      document.querySelector("#ubz-setting-198-text").innerHTML = "[198] C2c:    ";
      document.querySelector("#ubz-setting-199-text").innerHTML = "[199] CPA:    ";
      document.querySelector("#ubz-setting-200-text").innerHTML = "[200] CCr:     ";
      document.querySelector("#ubz-setting-201-text").innerHTML = "[201] rid:      ";
      document.querySelector("#ubz-setting-202-text").innerHTML = "[202] Sin:      ";
      document.querySelector("#ubz-setting-203-text").innerHTML = "[203] SiP:       ";
      document.querySelector("#ubz-setting-204-text").innerHTML = "[204] SiC:   ";
      document.querySelector("#ubz-setting-205-text").innerHTML = "[205] rrS:    ";
      document.querySelector("#ubz-setting-206-text").innerHTML = "[206] rrt:  , c";
      document.querySelector("#ubz-setting-207-text").innerHTML = "[207] tbU:    , ";
      document.querySelector("#ubz-setting-208-text").innerHTML = "[208] tCO:   , ";
      document.querySelector("#ubz-setting-209-text").innerHTML = "[209] LOC:   ";
      document.querySelector("#ubz-setting-210-text").innerHTML = "[210] PAS:   ";
      document.querySelector("#ubz-setting-211-text").innerHTML = "[211] PPP:   ";
      document.querySelector("#ubz-setting-212-text").innerHTML = "[212] rSA:   ";
      document.querySelector("#ubz-setting-213-text").innerHTML = "[213] rSS:  ";
      document.querySelector("#ubz-setting-214-text").innerHTML = "[214] rSP:     ";
      document.querySelector("#ubz-setting-215-text").innerHTML = "[215] rSO:    , ";
      document.querySelector("#ubz-setting-216-text").innerHTML = "[216] rPP:      ";
      document.querySelector("#ubz-setting-217-text").innerHTML = "[217] rEL:  ";
      document.querySelector("#ubz-setting-218-text").innerHTML = "[218] Ftt: , ";
      document.querySelector("#ubz-setting-219-text").innerHTML = "[219] ibt:       (), ";
      document.querySelector("#ubz-setting-220-text").innerHTML = "[220] ibr:   ";
      document.querySelector("#ubz-setting-221-text").innerHTML = "[221] dUd:        RS-232/RS485";
      document.querySelector("#ubz-setting-222-text").innerHTML = "[222] Ait:  , ";
      document.querySelector("#ubz-setting-223-text").innerHTML = "[223] Aib:  , ";
      document.querySelector("#ubz-setting-224-text").innerHTML = "[224] AiA:  ";
      document.querySelector("#ubz-setting-225-text").innerHTML = "[225] AiE:    ";
      document.querySelector("#ubz-setting-226-text").innerHTML = "[226] AUt:  , ";
      document.querySelector("#ubz-setting-227-text").innerHTML = "[227] AUb:  , ";
      document.querySelector("#ubz-setting-228-text").innerHTML = "[228] AUA:  ";
      document.querySelector("#ubz-setting-229-text").innerHTML = "[229] AUE:    ";
      document.querySelector("#ubz-setting-230-text").innerHTML = "[230] CCi:    ";
    }
  </script>
  
  <!-- Alarms defined in device -->
  <script type="text/javascript">
    const alarms = [
      {
        name: "Phase overcurrent",
        mnemonic: "A,<sup>=</sup>",
        address: 241,
        bit: 0,
        valueAddress: 300,
      },
      {
        name: "Thermal overload",
        mnemonic: "Adt",
        address: 241,
        bit: 1,
        valueAddress: 301,
      },
      {
        name: "Ground fault (zero sequence current)",
        mnemonic: "A,_",
        address: 241,
        bit: 2,
        valueAddress: 302,
      },
      {
        name: "Exceeded multiplicity", // ???
        mnemonic: "A,O",
        address: 241,
        bit: 3,
        valueAddress: 303,
      },
      {
        name: "Negative sequence current",
        mnemonic: "A,o",
        address: 241,
        bit: 4,
        valueAddress: 304,
      },
      {
        name: "Phase undercurrent",
        mnemonic: "A,<sub>=</sub>",
        address: 241,
        bit: 5,
        valueAddress: 305,
      },
      {
        name: "Delayed start",
        mnemonic: "APP",
        address: 241,
        bit: 6,
        valueAddress: 306,
      },
      {
        name: "Rotor blocking",
        mnemonic: "APb",
        address: 241,
        bit: 7,
        valueAddress: 307,
      },
      {
        name: "Temperature threshold at sensor 1",
        mnemonic: "At1",
        address: 241,
        bit: 8,
        valueAddress: 308,
      },
      {
        name: "Temperature threshold at sensor 2",
        mnemonic: "At2",
        address: 241,
        bit: 9,
        valueAddress: 309,
      },
      {
        name: "Phase sequence",
        mnemonic: "AU",
        address: 241,
        bit: 10,
        valueAddress: 310,
      },
      {
        name: "External MS",
        mnemonic: "ACo",
        address: 241,
        bit: 11,
        valueAddress: 311,
      },
      {
        name: "Line undervoltage",
        mnemonic: "AU<sub>=</sub>",
        address: 241,
        bit: 12,
        valueAddress: 312,
      },
      {
        name: "Line overvoltage",
        mnemonic: "AU<sup>=</sup>",
        address: 241,
        bit: 13,
        valueAddress: 313,
      },
      {
        name: "Phase imbalance",
        mnemonic: "AU<sup><\sup>",
        address: 241,
        bit: 14,
        valueAddress: 314,
      },
      {
        name: "Motor coil insulation resistance",
        mnemonic: "Ar,",
        address: 241,
        bit: 15,
        valueAddress: 315,
      },
      {
        name: "Remote control channel fault",
        mnemonic: "AdU",
        address: 242,
        bit: 0,
        valueAddress: undefined,
      },
      {
        name: "emergency motor stop without ARC",
        mnemonic: "EAd",
        address: 242,
        bit: 1,
        valueAddress: undefined,
      },
      {
        name: "emergency motor stop with ARC",
        mnemonic: "EOd",
        address: 242,
        bit: 2,
        valueAddress: undefined,
      },
      {
        name: "Short circuit of temperature sensor 1",
        mnemonic: "ES1",
        address: 242,
        bit: 3,
        valueAddress: undefined,
      },
      {
        name: "Breakout of temperature sensor 1",
        mnemonic: "EO1",
        address: 242,
        bit: 4,
        valueAddress: undefined,
      },
      {
        name: "Short circuit of temperature sensor 2",
        mnemonic: "ES2",
        address: 242,
        bit: 5,
        valueAddress: undefined,
      },
      {
        name: "Breakout of temperature sensor 2",
        mnemonic: "EO2",
        address: 242,
        bit: 6,
        valueAddress: undefined,
      },
      {
        name: "Phase loss",
        mnemonic: "E,U",
        address: 242,
        bit: 7,
        valueAddress: undefined,
      },
      {
        name: "EEPROM destruction",
        mnemonic: "EEP",
        address: 242,
        bit: 8,
        valueAddress: undefined,
      },
      {
        name: "0-20 mA analog input",
        mnemonic: "AA,",
        address: 242,
        bit: 9,
        valueAddress: 325,
      },
      {
        name: "0-10 V analog input",
        mnemonic: "AAU",
        address: 242,
        bit: 10,
        valueAddress: 326,
      },
    ];

    const ALARM_TYPES_NUMBER = alarms.length;

    function faultCodeToName(code) {
      return alarms[code].name;
    }
  </script>

  <!-- Registers processing -->
  <!-- Note: DEVICE_STR and DEVICE_ID should be defined externally -->
  <script type="text/javascript">
    const API_TOKEN = document.querySelector(".vis-view").getAttribute("apitoken");
    const API_BASE_URL = document.querySelector(".vis-view").getAttribute("apibaseurl");

    async function postResponse(body, url) {
      const res = await new Promise((resolve, reject) => {
        const request = new XMLHttpRequest();
        request.onload = function () {
          const data = JSON.parse(request.response);
          resolve(data);
        }

        request.onerror = function (err) {
          console.error(err);
          reject(err)
        }

        request.open("POST", url);
        request.setRequestHeader("authorization", `token ${API_TOKEN}`);
        request.setRequestHeader("Content-Type", "application/json");
        request.send(JSON.stringify(body));
      });

      return res;
    }

    async function getResponse(url) {
      const res = await new Promise((resolve, reject) => {
        const request = new XMLHttpRequest();
        request.onload = function () {
          const data = JSON.parse(request.response);
          resolve(data);
        }

        request.onerror = function (err) {
          console.error(err);
          reject(err)
        }

        request.open("GET", url);
        request.setRequestHeader("authorization", `token ${API_TOKEN}`);
        request.setRequestHeader("Content-Type", "application/json");
        request.send();
      });

      return res;
    }

    async function rawReadRegs(address, registersNum) {
      const deviceInfo = await getResponse(`${API_BASE_URL}/v1/device/${DEVICE_ID}/`);

      const body = {
        deviceModbusId: deviceInfo.modbusUnitId,
        address: address,
        kind: "holding",
        registersNum: registersNum,
        connection: {
          kind: "net-id",
          networkId: deviceInfo.netId,
        }
      };

      const res = await postResponse(body, `${API_BASE_URL}/v1/raw/read-register-group/`);
      return res;
    }

    // backported from rpm-416
    async function readLongReg(address) {
      const regs = await rawReadRegs(address, 2);
      if (regs.ok) {
        return ((regs.ok[0]) << 16) + regs.ok[1];
      } else {
        return undefined;
      }
    }

    async function writeRegValues(address, values) {
      const deviceInfo = await getResponse(`${API_BASE_URL}/v1/device/${DEVICE_ID}/`);

      const body = {
        deviceModbusId: deviceInfo.modbusUnitId,
        address: address,
        kind: "holding",
        value: values,
        connection: {
          kind: "net-id",
          networkId: deviceInfo.netId,
        }
      };

      const res = await postResponse(body, `${API_BASE_URL}/v1/raw/write-register-group/`);
      return res;
    }

    async function readRegFromDb(reg) {
      const deviceInfo = await getResponse(`${API_BASE_URL}/v1/device/${DEVICE_ID}/`);

      const netId = deviceInfo.netId;
      const netInfo = await getResponse(`${API_BASE_URL}/v1/net/${netId}/`);

      const orgId = netInfo.orgId;

      const bodyParam = DEVICE_STR + ">" + reg.toString();

      let paramId = await postResponse(bodyParam, `${API_BASE_URL}/v1/org/${orgId}/params/get-id-by-reference/`);

      const pointsLimit = 20;

      return await getResponse(`${API_BASE_URL}/v1/readings/get/?paramId=${paramId}&pointsLimit=${pointsLimit}`);
    }

    async function readBit(address, bitPosition) {
      if (bitPosition < 0 || bitPosition > 15 || bitPosition == undefined) {
        console.log("can't process the bit position");
        return NaN;
      }
      const rawReg = await rawReadRegs(address, 1);
      if (rawReg.ok) {
        return extractBitValue(rawReg.ok[0], bitPosition);
      } else {
        return undefined;
      }
    }

    function extractBitValue(value, bitPosition) {
      const bitValue = (value >>> bitPosition) & 1;
      return bitValue;
    }
  </script>

  <!-- Event fault class -->
  <script type="text/javascript">
    class EventFault {
      constructor() {
        this.code = undefined;
        this.value = undefined;
        this.time = undefined;
      }

      toString() {
        return "code: " + this.code.toString() + "\nvalue: " + this.value.toString() + "\ntime: " + this.time.toString() + "\n";
      }

      isUndefined() {
        return this.code == undefined && this.value == undefined && this.time == undefined;
      }
    }

    async function processEventLog() {
      let eventLog = [new EventFault(), new EventFault(), new EventFault(), new EventFault(), new EventFault()];
      const eventLogRawRegs = await rawReadRegs(243, (4 * 5));
      if (eventLogRawRegs.ok) {
        for (let i = 0; i < 5; i++) {
          eventLog[i].code = eventLogRawRegs.ok[i * 4];
          eventLog[i].value = eventLogRawRegs.ok[i * 4 + 1];
          eventLog[i].time = (eventLogRawRegs.ok[i * 4 + 2] << 16) + eventLogRawRegs.ok[i * 4 + 3];
        }
      }
      return eventLog;
    }

    async function getTimeStrFromSwitchingOn() {
      const timeRegs = await rawReadRegs(98, 2);
      if (timeRegs.ok) {
        const regHi = timeRegs.ok[0];
        const regLo = timeRegs.ok[1];
        const time = (regHi << 16) + regLo;
        const h = Math.floor(time / 60);
        const m = time % 60;
        const hStr = (h < 10) ? "0" + h.toString() : h.toString();
        const mStr = (m < 10) ? "0" + m.toString() : m.toString();
        return hStr + " h : " + mStr + " m";
      } else {
        return "cannot read time from power on device";
      }
    }
  </script>

  <!-- Report HTML creation -->
  <script type="text/javascript">
    var ubzCommunicationAddress = undefined;

    function eventToReadableStrings(event) {
      let out = {
        timeStr: "",
        valueStr: "",
      };

      // "When UBZ is powered on, 5000000 is written into the registers used to store fault time." - documentation
      if (event.time == 5000000) {
        out.timeStr = "-- h : -- m";
        out.valueStr = event.value.toString();
      } else {
        let h = event.time / 3600;
        let m = (event.time % 3600) / 60;
        out.timeStr = h.toString() + " h : " + m.toString() + " m";
      }

      if (event.code == 10 && event.value == 10000) {
        out.valueStr = "------";
      } else {
        out.valueStr = event.value.toString();
      }

      return out;
    }

    async function createReportURL() {
      let eventlog = await processEventLog();
      if (eventlog[0].isUndefined() && eventlog[1].isUndefined() && eventlog[2].isUndefined() && eventlog[3].isUndefined() && eventlog[4].isUndefined()) {
        return "";
      }
      const now = new Date();

      let eventLogString =
        "<html>\
    <head>\
        <title>Log of failures UBZ</title>\
    </head>\
    <body bgcolor='#000080' text='#FFFFFF' link='#C1E0FF' vlink='#C1E0FF' alink='#F0FBFF' style='font-family: Arial'>\
    <p><u><strong><big><big>Log of failures UBZ</big></big></strong></u><br>It is generated ";

      eventLogString += now.toDateString() + " at " + now.toLocaleTimeString() + "<p>\
        The device name: UBZ-302 (standart) <br>\
        Firmware version: ";

      const firmwareVersionRaw = await rawReadRegs(217, 1);
      if (firmwareVersionRaw.ok) {
        eventLogString += firmwareVersionRaw.ok[0].toString();
      } else {
        eventLogString += "cannot read firmware version";
      }

      eventLogString += "<br>Address: ";
      if (ubzCommunicationAddress) {
        eventLogString += ubzCommunicationAddress.toString() + "\n";
      } else {
        eventLogString += "undefined\n";
      }

      let timeFromPowerOnStr = await getTimeStrFromSwitchingOn();
      eventLogString +=
        "<br>Time from power on device: ";
      eventLogString += timeFromPowerOnStr;

      eventLogString += "<br></p>\
            <table border='0' width='100%'>\
     <tr>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF>#</font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF></font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF>The failure name</font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF></font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF>Failure time</font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF></font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF>Value</font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF></font></strong></td>\
      <td bgcolor='#0040D5' align='left'><strong><font color=#FFFFFF>Code</font></strong></td>\
     </tr> ";

      for (let i = 0; i < 5; i++) {
        const eventReadableStrings = eventToReadableStrings(eventlog[i]);
        let timeStr = "";
        if (eventlog[i].time == 0) {
          timeStr = timeFromPowerOnStr;
        } else {
          timeStr = eventReadableStrings.timeStr;
        }
        eventLogString +=
          "<tr>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF>" + (i + 1).toString() + "</font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF></font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF>" + faultCodeToName(eventlog[i].code) + "</font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF></font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF>" + timeStr + "</font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF></font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF>" + eventReadableStrings.valueStr + "</font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF></font>&nbsp;</td>\
    <td valign='middle' align='left' bgcolor='#8080FF'>&nbsp;<font color=#FFFFFF>" + eventlog[i].code.toString() + "</font>&nbsp;</td>\
    </tr>";
      }

      eventLogString +=
        "</table><p>Failure time - is measured from the moment of power on UBZ and till the moment of occurrence of failure.</p>\
    <p>Failures are sorted with a bottom upwards by a stack method (i.e. the last failure is from above).</p>\
    </body>\
    </html>";

      return URL.createObjectURL(new Blob([eventLogString], { type: 'text/html' }));
    }
  </script>

  <!-- Misc. -->
  <script type="text/javascript">
    function temperatureSensorReadable(value) {
      if (value == 5000) {
        return "Off";
      } else if (value <= 2010 && value >= 1990) {
        return "Fault";
      } else if (value <= 1010 && value >= 990) {
        return "S/C"
      } else if (value <= 220 && value >= -40) {
        return String(value);
      } else {
        return "Und.";
      }
    }

    function sinFromCos(cosValue) {
      return Math.sqrt(1 - Math.pow(cosValue, 2));
    }

    function timeString(dateTime) {
      const hoursNum = dateTime.getHours();
      let hoursStr = hoursNum.toString();
      if (hoursNum < 10) {
        hoursStr = "0" + hoursStr;
      }

      const minutesNum = dateTime.getMinutes();
      let minutesStr = minutesNum.toString();
      if (minutesNum < 10) {
        minutesStr = "0" + minutesStr;
      }

      const secondsNum = dateTime.getSeconds();
      let secondsStr = secondsNum.toString();
      if (secondsNum < 10) {
        secondsStr = "0" + secondsStr;
      }

      return hoursStr + ":" + minutesStr + ":" + secondsStr;
    }

    function timeStringFromMillis(milliseconds) {
      let hoursNum = Math.floor(milliseconds / 3600000);
      let hoursStr = hoursNum.toString();
      if (hoursNum < 10) {
        hoursStr = "0" + hoursStr;
      }

      const minutesNum = Math.floor((milliseconds % 3600000) / 60000);
      let minutesStr = minutesNum.toString();
      if (minutesNum < 10) {
        minutesStr = "0" + minutesStr;
      }

      const secondsNum = Math.floor((milliseconds % 60000) / 1000);
      let secondsStr = secondsNum.toString();
      if (secondsNum < 10) {
        secondsStr = "0" + secondsStr;
      }

      return hoursStr + ":" + minutesStr + ":" + secondsStr;
    }

    function activateExternalCTsettings() {
      if (document.querySelector("#external-ct-current").disabled) {
        document.querySelector("#external-ct-current").disabled = false;
      }
      if (document.querySelector("#motor-rated-current").disabled) {
        document.querySelector("#motor-rated-current").disabled = false;
      }
    }

    function deactivateExternalCTsettings() {
      if (!(document.querySelector("#external-ct-current").disabled)) {
        document.querySelector("#external-ct-current").disabled = true;
      }
      if (!(document.querySelector("#motor-rated-current").disabled)) {
        document.querySelector("#motor-rated-current").disabled = true;
      }
    }

    function determineHeatgraphColor(value) {
      let color = "";

      if (value >= 100) {
        color = "rgba(200, 50, 50, 1)";
      } else if (value >= 66) {
        color = "rgba(150, 150, 50, 1)";
      } else {
        color = "rgba(50, 50, 200, 1)";
      }

      return color;
    }

    function switchableGraphsByCheckbox(checkboxSelector, id1Selector, id2Selector) {
      let checkbox = document.querySelector(checkboxSelector);
      checkbox.addEventListener("change", function () {
        if (checkbox.checked) {
          document.querySelector(id1Selector).style.display = 'none';
          document.querySelector(id2Selector).style.display = 'block';
        } else {
          document.querySelector(id1Selector).style.display = 'block';
          document.querySelector(id2Selector).style.display = 'none';
        }
      })
    }

    function spinnersOn(list) {
      list.forEach((spinner) => {
        spinner.classList.remove("spinner-invisible");
      });
    }

    function spinnersOff(list) {
      list.forEach((spinner) => {
        spinner.classList.add("spinner-invisible");
      });
    }
  </script>

  <!-- Multicolor bar processing -->
  <script type="text/javascript">
    function barValue(barId, maxValue, threshold1, threshold2) {
      const v = document.querySelector(barId).value;
      const widthPercentage = 100 * v / maxValue;
      const innerBarId = barId + '-inner';

      let threshold1Percentage = undefined;
      let threshold2Percentage = undefined;

      if ((threshold2 !== undefined) && (threshold1 !== undefined)) {
        threshold1Percentage = 100 * threshold1 / maxValue;
        threshold2Percentage = 100 * threshold2 / maxValue;

        const innerOverBarId = barId + '-over-inner';
        const innerOver2BarId = barId + '-over2-inner';

        if (widthPercentage <= threshold1Percentage) {
          const widthPercentageStr = widthPercentage.toFixed(0) + '%';
          document.querySelector(innerBarId).style.width = widthPercentageStr;
          document.querySelector(innerOverBarId).style.width = "0%";
          document.querySelector(innerOver2BarId).style.width = "0%";
        } else if (widthPercentage <= threshold2Percentage) {
          const widthPercentageStr = threshold1Percentage.toFixed(0) + '%';
          document.querySelector(innerBarId).style.width = widthPercentageStr;
          const widthPercentageOverStr = (widthPercentage - threshold1Percentage).toFixed(0) + '%';
          document.querySelector(innerOverBarId).style.width = widthPercentageOverStr;
          document.querySelector(innerOver2BarId).style.width = "0%";
        } else if (widthPercentage <= 100) {
          const widthPercentageStr = threshold1Percentage.toFixed(0) + '%';
          document.querySelector(innerBarId).style.width = widthPercentageStr;
          const widthPercentageOverStr = (threshold2Percentage - threshold1Percentage).toFixed(0) + '%';
          document.querySelector(innerOverBarId).style.width = widthPercentageOverStr;
          const widthPercentageOver2Str = (widthPercentage - threshold2Percentage).toFixed(0) + '%';
          document.querySelector(innerOver2BarId).style.width = widthPercentageOver2Str;
        }
      } else if (threshold1 !== undefined) {
        threshold1Percentage = 100 * threshold1 / maxValue;

        const innerOverBarId = barId + '-over-inner';

        if (widthPercentage <= threshold1Percentage) {
          const widthPercentageStr = widthPercentage.toFixed(0) + '%';
          document.querySelector(innerBarId).style.width = widthPercentageStr;
          document.querySelector(innerOverBarId).style.width = "0%";
        } else if (widthPercentage <= 100) {
          const widthPercentageStr = threshold1Percentage.toFixed(0) + '%';
          document.querySelector(innerBarId).style.width = widthPercentageStr;
          const widthPercentageOverStr = (widthPercentage - threshold1Percentage).toFixed(0) + '%';
          document.querySelector(innerOverBarId).style.width = widthPercentageOverStr;
        }
      }
      if ((threshold1 === undefined) && (threshold2 === undefined)) {
        const widthPercentageStr = widthPercentage.toFixed(0) + '%';
        document.querySelector(innerBarId).style.width = widthPercentageStr;
      }
    }
  </script>

  <!-- Add a row in the table -->
  <script type="text/javascript">
    var rowIsEven = false;

    function addRow(col1innerHtml, col2innerHtml, col3innerHtml, col4innerHtml) {
      let tableBody = document.querySelector("#faults-table-body");

      let row = document.createElement("tr");
      if (rowIsEven) {
        row.style.backgroundColor = "whitesmoke";
      } else {
        row.style.backgroundColor = "white";
      }

      let cell1 = document.createElement("td");
      let cell2 = document.createElement("td");
      let cell3 = document.createElement("td");
      let cell4 = document.createElement("td");

      cell1.innerHTML = col1innerHtml;
      cell2.innerHTML = col2innerHtml;
      cell3.innerHTML = col3innerHtml;
      cell4.innerHTML = col4innerHtml;

      row.appendChild(cell1);
      row.appendChild(cell2);
      row.appendChild(cell3);
      row.appendChild(cell4);

      tableBody.appendChild(row);
      rowIsEven = !rowIsEven;
    }
  </script>

  <!-- Registers reading in loop -->
  <script type="text/javascript">
    const CYCLE_MAX_NUMBER = 10;
    var cycleNumber = 0;

    const PRIORITY_DIVISOR_HIGH = 1;
    const PRIORITY_DIVISOR_MID = 5;
    const PRIORITY_DIVISOR_LOW = 10;

    const readSpinnersList = document.querySelectorAll(".reading-process-spinner");

    const mapRegisters = new Map();
    async function batchRegistersRead() {
      if (cycleNumber % PRIORITY_DIVISOR_HIGH == 0) {
        spinnersOn(readSpinnersList);
        const regs100_132 = await rawReadRegs(100, 33);
        if (regs100_132.ok) {
          for (i = 0; i < 33; i++) {
            mapRegisters.set(100 + i, regs100_132.ok[i]);
          }
        } else {
          for (i = 0; i < 33; i++) {
            mapRegisters.set(100 + i, undefined);
          }
        }

        mapRegisters.set(135, await readLongReg(135));
        mapRegisters.set(137, await readLongReg(137));
        mapRegisters.set(139, await readLongReg(139));

        spinnersOff(readSpinnersList);

        const regs150_153 = await rawReadRegs(150, 4);
        if (regs150_153.ok) {
          mapRegisters.set(150, regs150_153.ok[0]);
          mapRegisters.set(151, regs150_153.ok[1]);
          mapRegisters.set(152, regs150_153.ok[2]);
          mapRegisters.set(153, regs150_153.ok[3]);
        } else {
          mapRegisters.set(150, undefined);
          mapRegisters.set(151, undefined);
          mapRegisters.set(152, undefined);
          mapRegisters.set(153, undefined);
        }

        const reg177 = await rawReadRegs(177, 1);
        if (reg177.ok) {
          mapRegisters.set(177, reg177.ok[0]);
        } else {
          mapRegisters.set(177, undefined);
        }

        const reg180 = await rawReadRegs(180, 1);
        if (reg180.ok) {
          mapRegisters.set(180, reg180.ok[0]);
        } else {
          mapRegisters.set(180, undefined);
        }
      }

      if (cycleNumber % PRIORITY_DIVISOR_LOW == 0) {
        mapRegisters.set(await readLongReg(133));

        const reg203 = await rawReadRegs(203, 1);
        if (reg203.ok) {
          mapRegisters.set(203, reg203.ok[0]);
        } else {
          mapRegisters.set(203, undefined);
        }

        const reg205 = await rawReadRegs(205, 1);
        if (reg205.ok) {
          mapRegisters.set(205, reg205.ok[0]);
        } else {
          mapRegisters.set(205, undefined);
        }

        const regs211 = await rawReadRegs(211, 3);
        if (regs211.ok) {
          for (i = 0; i < 3; i++) {
            mapRegisters.set(211 + i, regs211.ok[i]);
          }
        } else {
          for (i = 0; i < 3; i++) {
            mapRegisters.set(211 + i, undefined);
          }
        }

        const reg221 = await rawReadRegs(221, 1);
        if (reg221.ok) {
          mapRegisters.set(221, reg221.ok[0]);
        } else {
          mapRegisters.set(221, undefined);
        }

        const reg224 = await rawReadRegs(224, 1);
        if (reg224.ok) {
          mapRegisters.set(224, reg224.ok[0]);
        } else {
          mapRegisters.set(224, undefined);
        }

        const reg228 = await rawReadRegs(228, 1);
        if (reg228.ok) {
          mapRegisters.set(228, reg228.ok[0]);
        } else {
          mapRegisters.set(228, undefined);
        }
      }

      if (cycleNumber % PRIORITY_DIVISOR_MID == 0) {
        const regsModeAlarms = await rawReadRegs(240, 3);
        if (regsModeAlarms.ok) {
          mapRegisters.set(240, regsModeAlarms.ok[0]);
          mapRegisters.set(241, regsModeAlarms.ok[1]);
          mapRegisters.set(242, regsModeAlarms.ok[2]);
        } else {
          mapRegisters.set(240, undefined);
          mapRegisters.set(241, undefined);
          mapRegisters.set(242, undefined);
        }
      }

      cycleNumber = (cycleNumber + 1) % CYCLE_MAX_NUMBER;
    }
  </script>

  <!-- Fault processing -->
  <script type="text/javascript">
    var faultsPrev = Array(ALARM_TYPES_NUMBER).fill(false);
    var faultsCurr = Array(ALARM_TYPES_NUMBER).fill(false);

    async function determineFaults() {
      const FAULT = 1;

      // set of alarms bit located in these two registers:
      let alarmsBits1 = mapRegisters.get(alarms[0].address);
      let alarmsBits2 = mapRegisters.get(alarms[0].address + 1);
      if (alarmsBits1 != undefined && alarmsBits2 != undefined) {
        for (let i = 0; i < 16; i++) {
          faultsCurr[i] = ((alarmsBits1 >>> i) & 1) === FAULT;
        }
        for (let i = 16; i < ALARM_TYPES_NUMBER; i++) {
          faultsCurr[i] = ((alarmsBits2 >>> (i - 16)) & 1) === FAULT;
        }
      }
    }

    function faultsSouldBePrinted(faultsPrev, faultsCurr) /* boolean arrays */ {
      if (faultsPrev.length != faultsCurr.length) {
        console.warn("arrays lengths must be equal!");
        return undefined;
      }

      const shouldBePrinted = Array(faultsCurr.length).fill(false);

      for (let i = 0; i < faultsCurr.length; i++) {
        if ((!faultsPrev[i]) && (faultsCurr[i])) {
          shouldBePrinted[i] = true;
        }
      }

      return shouldBePrinted;
    }
  </script>

  <!-- Graph -->
  <script type="text/javascript">
    class GraphSequencing {
      constructor(capacity) {
        this.idx = 0;
        this.queue = new Array();
        this.capacity = capacity;
      }

      get maxIndex() {
        return this.capacity - 1;
      }

      push(element, colors) {
        while (this.queue.length >= this.capacity) {
          this.queue.shift();
        }
        const timestamp = [new Date().valueOf()];
        this.queue.push({ element, colors, timestamp });
      }

      pushFromHistory(element, timestamp, colors) {
        while (this.queue.length >= this.capacity) {
          this.queue.shift();
        }
        this.queue.push({ element, colors, timestamp });
      }

      turn() {
        if (this.idx < this.capacity) {
          this.idx++;
        } else {
          this.idx = 0;
        }
      }
    }

    class Graph {
      constructor(capacity, selector, graphsNumber) {
        this.sequencing = new GraphSequencing(capacity);

        this.chart = new Chart(document.querySelector(selector).getContext("2d"), {
          data: {
            datasets: new Array(graphsNumber).fill().map(function () {
              return {
                type: "scatter",
                data: new Array(capacity).fill({ x: undefined, y: undefined }),
                backgroundColor: "grey",
                borderColor: "rgba(128, 128, 128, 0.5)",
              }
            }),
          },
          options: {
            animation: false,
            showLine: true,
            scales: {
              x: {
                ticks: {
                  callback: function (value, index, ticks) {
                    return value + 's';
                  },
                },
                reverse: true,
                min: 0,
                max: 0,
              }
            }
          }
        });

        this.minutesScale = false;

        this.debug = false;
      }

      setMaxX(value) {
        this.chart.options.scales.x.max = value;
        this.chart.update();
      }

      setDataLabels(labels) {
        for (let i = 0; i < labels.length; i++) {
          this.chart.data.datasets[i].label = labels[i];
        }
        this.chart.update();
      }

      setDatachartType(datasetIndex, typestr) {
        this.chart.data.datasets[datasetIndex].type = typestr;
        this.chart.update();
      }

      setColors(colors) {
        for (let i = 0; i < colors.length; i++) {
          this.chart.data.datasets[i].backgroundColor = colors[i];
          this.chart.data.datasets[i].borderColor = colors[i];
        }
        this.chart.update();
      }

      setMinutesScale() {
        this.minutesScale = true;
        this.chart.options.scales.x.ticks.callback = function (value, index, ticks) {
          return value + 'm';
        };
        this.chart.update();
      }

      setThinnerLines() {
        this.chart.options.elements.point.radius = 0;
        this.chart.options.elements.line.borderWidth = 2;
      }

      addPoint(values) {
        this.sequencing.push(values, undefined);

        let data = this.sequencing.queue;
        const datasetsNumber = values.length;
        const now = new Date().valueOf();

        for (let i = 0; i < data.length; i++) {
          for (let ds = 0; ds < datasetsNumber; ds++) {
            if (this.minutesScale == true) {
              this.chart.data.datasets[ds].data[this.sequencing.maxIndex - i] = {
                x: (now - data[i].timestamp[0]) / 60000,
                y: data[i].element[ds],
              };
            } else {
              this.chart.data.datasets[ds].data[this.sequencing.maxIndex - i] = {
                x: (now - data[i].timestamp[0]) / 1000,
                y: data[i].element[ds],
              };
            }
          }
        }

        this.chart.update();
        this.sequencing.turn();
      }

      addFromHistory(values, timestamp) {
        this.sequencing.pushFromHistory(values, timestamp, undefined);

        let data = this.sequencing.queue;
        const datasetsNumber = values.length;
        const now = new Date().valueOf();

        for (let i = 0; i < data.length; i++) {
          for (let ds = 0; ds < datasetsNumber; ds++) {
            if (this.minutesScale == true) {
              this.chart.data.datasets[ds].data[this.sequencing.maxIndex - i] = {
                x: (now - data[i].timestamp[ds]) / 60000,
                y: data[i].element[ds],
              };
            } else {
              this.chart.data.datasets[ds].data[this.sequencing.maxIndex - i] = {
                x: (now - data[i].timestamp[ds]) / 1000,
                y: data[i].element[ds],
              };
            }
          }
        }

        this.chart.update();
        this.sequencing.turn();
      }
    }

    /***********/
    /* Thermal */
    /***********/

    var tempGraph = new Graph(30, "#heating-graph", 3);
    if (VIS_LOCALE_SETTING === "ru_RU") {
      tempGraph.setDataLabels([", %  .", "66%", "100%"]);
    } else {
      tempGraph.setDataLabels(["Temperature, % of max", "66%", "100%"]);
    }
    
    tempGraph.setColors(["grey", "rgba(50, 50, 200, 1)", "rgba(200, 50, 50, 1)"]);
    tempGraph.setDatachartType(1, "line");
    tempGraph.setDatachartType(2, "line");

    /************/
    /* Voltages */
    /************/

    var voltGraph = new Graph(20, "#voltage-phases-graph", 3);
    if (VIS_LOCALE_SETTING === "ru_RU") {
      voltGraph.setDataLabels(["  1", "  2", "  3"]);
    } else {
      voltGraph.setDataLabels(["Voltage phase 1", "Voltage phase 2", "Voltage phase 3"]);
    }
    voltGraph.setMaxX(60);
    voltGraph.setColors(["yellowgreen", "limegreen", "forestgreen"]);

    var voltGraphM = new Graph(1000, "#voltage-phases-graph-m", 3);
    if (VIS_LOCALE_SETTING === "ru_RU") {
      voltGraphM.setDataLabels(["  1", "  2", "  3"]);
    } else {
      voltGraphM.setDataLabels(["Voltage phase 1", "Voltage phase 2", "Voltage phase 3"]);
    }
    
    voltGraphM.setMaxX(20);
    voltGraphM.setColors(["yellowgreen", "limegreen", "forestgreen"]);
    voltGraphM.setMinutesScale();
    voltGraphM.setThinnerLines();

    /****************/
    /* Currents RMS */
    /****************/

    var ampGraph = new Graph(20, "#amperage-phases-graph", 3);
    if (VIS_LOCALE_SETTING === "ru_RU") {
      ampGraph.setDataLabels([" .  1", " .  2", " .  3"]);
    } else {
      ampGraph.setDataLabels(["Current RMS phase 1", "Current RMS phase 2", "Current RMS phase 3"]);
    }
    
    ampGraph.setMaxX(60);
    ampGraph.setColors(["orange", "gold", "goldenrod"]);

    var ampGraphM = new Graph(1000, "#amperage-phases-graph-m", 3);
    if (VIS_LOCALE_SETTING === "ru_RU") {
      ampGraphM.setDataLabels([" .  1", " .  2", " .  3"]);
    } else {
      ampGraphM.setDataLabels(["Current RMS phase 1", "Current RMS phase 2", "Current RMS phase 3"]);
    }
    
    ampGraphM.setMaxX(20);
    ampGraphM.setColors(["orange", "gold", "goldenrod"]);
    ampGraphM.setMinutesScale();
    ampGraphM.setThinnerLines();
  </script>

  <!-- Indicators -->
  <script type="text/javascript">
    async function processUbzStatuses() {
      const mmspMode = mapRegisters.get(102);

      const LOAD_RELAY_BIT = 1;
      const FUNCTIONAL_RELAY_BIT = 2;
      const CLOSED = 1;

      if (mmspMode != undefined) {
        if (mmspMode == 1) {
          document.querySelector("#mmsp-mode").classList.add("btn-pulse");
        }
      }
      else {
        document.querySelector("#mmsp-mode").classList.remove("btn-pulse");
      }

      const bitsValue = mapRegisters.get(240);

      if (extractBitValue(bitsValue, FUNCTIONAL_RELAY_BIT) == CLOSED) {
        document.querySelector("#functional-relay-mode").classList.add("btn-pulse");
      } else {
        document.querySelector("#functional-relay-mode").classList.remove("btn-pulse");
      }

      if (extractBitValue(bitsValue, LOAD_RELAY_BIT) == CLOSED) {
        document.querySelector("#motor-relay-mode").classList.add("btn-pulse");
      } else {
        document.querySelector("#motor-relay-mode").classList.remove("btn-pulse");
      }
    }

    var motorStartedManually = false;

    const COMMAND_REGISTER = 237;
    const MOTOR_STOP_MANUALLY = [0];
    const MOTOR_START_MANUALLY = [2];
    const RESET_FAULT = [55];

    async function startStopMotor() {
      if (!motorStartedManually) {
        await writeRegValues(COMMAND_REGISTER, MOTOR_START_MANUALLY);
        document.querySelector("#motor-start-stop-button").innerHTML = "Stop";
        motorStartedManually = true;
      } else {
        await writeRegValues(COMMAND_REGISTER, MOTOR_STOP_MANUALLY);
        document.querySelector("#motor-start-stop-button").innerHTML = "Start";
        motorStartedManually = false;
      }
    }

    async function processArIndicator() {
      const ALLOW_REMOTE = 2;

      if (mapRegisters.get(203) == ALLOW_REMOTE) {
        document.querySelector("#ar-indicator").classList.add("btn-pulse");
      } else {
        document.querySelector("#ar-indicator").classList.remove("btn-pulse");
      }
    }

    async function processRcIndicator() {
      const PROHIBITED = 0;

      if (mapRegisters.get(221) != PROHIBITED && mapRegisters.get(221) != undefined) {
        document.querySelector("#rc-indicator").classList.add("btn-pulse");
        document.querySelector("#motor-start-stop-button").innerHTML = "Start";
        document.querySelector("#motor-start-stop-button").disabled = false;
        document.querySelector("#motor-start-stop-button").addEventListener("click", startStopMotor);
      } else {
        document.querySelector("#rc-indicator").classList.remove("btn-pulse");
        document.querySelector("#motor-start-stop-button").innerHTML = "Automatic mode";
        document.querySelector("#motor-start-stop-button").disabled = true;
        document.querySelector("#motor-start-stop-button").removeEventListener("click", startStopMotor);
      }
    }

    async function processExternalInputIndicator() {
      const INDICATOR_LIT = "orange";
      const INDICATOR_DIM = "darkgoldenrod";

      if (mapRegisters.get(224) == undefined || mapRegisters.get(228) == undefined) {
        document.querySelector("#ext-in-indicator").classList.remove("btn-pulse");
      } else if (mapRegisters.get(224) != 0 && mapRegisters.get(228) != 0) {
        document.querySelector("#ext-in-indicator").classList.add("btn-pulse");
      } else {
        document.querySelector("#ext-in-indicator").classList.remove("btn-pulse");
      }
    }

    function processFaultIndicator(isFault) {
      if (isFault) {
        document.querySelector("#fault-indicator").classList.add("btn-pulse");
      } else {
        document.querySelector("#fault-indicator").classList.remove("btn-pulse");
      }
    }
  </script>

  <!-- Selection listeners -->
  <script type="text/javascript">
    async function stringPowerCharacteristicByKey(keystring) {
      var outstring = VIS_LOCALE_SETTING === "ru_RU" ? "" : "Unknown";
      switch (keystring) {
        case "phase-1-full-power":
          {
            const RMSVoltagePhase1 = mapRegisters.get(114);
            const RMSCurrentPhase1 = mapRegisters.get(100);
            if (RMSVoltagePhase1 != undefined && RMSCurrentPhase1 != undefined) {
              const phase1FullPower = RMSVoltagePhase1 * RMSCurrentPhase1 * 0.1;
              outstring = phase1FullPower.toString();
            }
          }
          break;
        case "phase-2-full-power":
          {
            const RMSVoltagePhase2 = mapRegisters.get(115);
            const RMSCurrentPhase2 = mapRegisters.get(101);
            if (RMSVoltagePhase2 != undefined && RMSCurrentPhase2 != undefined) {
              const phase2FullPower = RMSVoltagePhase2 * RMSCurrentPhase2 * 0.1;
              outstring = phase2FullPower.toString();
            }
          }
          break;
        case "phase-3-full-power":
          {
            const RMSVoltagePhase3 = mapRegisters.get(116);
            const RMSCurrentPhase3 = mapRegisters.get(102);
            if (RMSVoltagePhase3 != undefined && RMSCurrentPhase3 != undefined) {
              const phase3FullPower = RMSVoltagePhase3 * RMSCurrentPhase3 * 0.1;
              outstring = phase3FullPower.toString();
            }
          }
          break;
        case "phase-1-active-power":
          {
            const RMSVoltagePhase1 = mapRegisters.get(114);
            const RMSCurrentPhase1 = mapRegisters.get(100);
            const cosPhiPhase1 = await readLongReg(141);
            if (RMSVoltagePhase1 != undefined && RMSCurrentPhase1 != undefined && cosPhiPhase1 != undefined) {
              const phase1activePower = RMSVoltagePhase1 * RMSCurrentPhase1 * 0.1 * cosPhiPhase1 * 0.001;
              outstring = phase1activePower.toString();
            }
          }
          break;
        case "phase-2-active-power":
          {
            const RMSVoltagePhase2 = mapRegisters.get(115);
            const RMSCurrentPhase2 = mapRegisters.get(101);
            const cosPhiPhase2 = await readLongReg(143);
            if (RMSVoltagePhase2 != undefined && RMSCurrentPhase2 != undefined && cosPhiPhase2 != undefined) {
              const phase2activePower = RMSVoltagePhase2 * RMSCurrentPhase2 * 0.1 * cosPhiPhase2 * 0.001;
              outstring = phase2activePower.toString();
            }
          }
          break;
        case "phase-3-active-power":
          {
            const RMSVoltagePhase3 = mapRegisters.get(116);
            const RMSCurrentPhase3 = mapRegisters.get(102);
            const cosPhiPhase3 = await readLongReg(145);
            if (RMSVoltagePhase3 != undefined && RMSCurrentPhase3 != undefined && cosPhiPhase3 != undefined) {
              const phase3activePower = RMSVoltagePhase3 * RMSCurrentPhase3 * 0.1 * cosPhiPhase3 * 0.001;
              outstring = phase3activePower.toString();
            }
          }
          break;
        case "phase-1-reactive-power":
          {
            const RMSVoltagePhase1 = mapRegisters.get(114);
            const RMSCurrentPhase1 = mapRegisters.get(100);
            const cosPhiPhase1 = await readLongReg(141);
            if (RMSVoltagePhase1 != undefined && RMSCurrentPhase1 != undefined && cosPhiPhase1 != undefined) {
              const sinPhiPhase1 = sinFromCos(cosPhiPhase1 * 0.001);
              const phase1reactivePower = RMSVoltagePhase1 * RMSCurrentPhase1 * 0.1 * sinPhiPhase1;
              outstring = phase1reactivePower.toString();
            }
          }
          break;
        case "phase-2-reactive-power":
          {
            const RMSVoltagePhase2 = mapRegisters.get(115);
            const RMSCurrentPhase2 = mapRegisters.get(101);
            const cosPhiPhase2 = await readLongReg(143);
            if (RMSVoltagePhase2 != undefined && RMSCurrentPhase2 != undefined && cosPhiPhase2 != undefined) {
              const sinPhiPhase2 = sinFromCos(cosPhiPhase2 * 0.001);
              const phase2reactivePower = RMSVoltagePhase2 * RMSCurrentPhase2 * 0.1 * sinPhiPhase2;
              outstring = phase2reactivePower.toString();
            }
          }
          break;
        case "phase-3-reactive-power":
          {
            const RMSVoltagePhase3 = mapRegisters.get(116);
            const RMSCurrentPhase3 = mapRegisters.get(102);
            const cosPhiPhase3 = await readLongReg(145);
            if (RMSVoltagePhase3 != undefined && RMSCurrentPhase3 != undefined && cosPhiPhase3 != undefined) {
              const sinPhiPhase3 = sinFromCos(cosPhiPhase3 * 0.001);
              const phase3reactivePower = RMSVoltagePhase3 * RMSCurrentPhase3 * 0.1 * sinPhiPhase3;
              outstring = phase3reactivePower.toString();
            }
          }
          break;
        case "phase-1-cos-phi":
          {
            const cosPhiPhase1Raw = await readLongReg(141); 
            if (cosPhiPhase1Raw != undefined) {
              const cosPhiPhase1 = cosPhiPhase1Raw * 0.001;
              outstring = cosPhiPhase1.toFixed(3);
            }
          }
          break;
        case "phase-2-cos-phi":
          {
            const cosPhiPhase2Raw = await readLongReg(143);
            if (cosPhiPhase2Raw != undefined) {
              const cosPhiPhase2 = cosPhiPhase2Raw * 0.001;
              outstring = cosPhiPhase2.toFixed(3);
            }
          }
          break;
        case "phase-3-cos-phi":
          {
            const cosPhiPhase3Raw = await readLongReg(145);
            if (cosPhiPhase3Raw != undefined) {
              const cosPhiPhase3 = cosPhiPhase3Raw * 0.001;
              outstring = cosPhiPhase3.toFixed(3);
            }
          }
          break;
        case "no-selection":
          outstring = "";
          break;
      }
      return outstring;
    }
  </script>

  <!-- Event listeners -->
  <script type="text/javascript">
    // TODO: affect only when changed
    document.querySelector("#radio-workmode-alarm").addEventListener("click", async function () {
      await writeRegValues(205, [0]);
    });

    document.querySelector("#radio-workmode-time").addEventListener("click", async function () {
      await writeRegValues(205, [1]);
    });

    document.querySelector("#radio-workmode-stardelta").addEventListener("click", async function () {
      await writeRegValues(205, [2]);
    });

    document.querySelector("#reset-fault-button").addEventListener("click", async function () {
      document.querySelector("#reset-fault-button-spinner").classList.remove("spinner-invisible");
      await writeRegValues(COMMAND_REGISTER, RESET_FAULT);
      document.querySelector("#reset-fault-button-spinner").classList.add("spinner-invisible");
    });

    document.querySelector("#power-characteristic-value-1").addEventListener("change", async function () {
      const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-1").value);
      document.querySelector("#power-show-value-1").innerHTML = characteristicString;
    });

    document.querySelector("#power-characteristic-value-2").addEventListener("change", async function () {
      const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-2").value);
      document.querySelector("#power-show-value-2").innerHTML = characteristicString;
    });

    document.querySelector("#power-characteristic-value-3").addEventListener("change", async function () {
      const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-3").value);
      document.querySelector("#power-show-value-3").innerHTML = characteristicString;
    });

    document.querySelector("#save-file-button").addEventListener("click", async function () {
      document.querySelector("#save-file-button-spinner").classList.remove("spinner-invisible");
      const now = new Date();
      const promiseTimeout = new Promise((resolve, reject) => {
        setTimeout(() => "", 10000);
      });
      const url = await createReportURL();
      if (url.length == 0) {
        console.log("No response for report");
      } else {
        const hiddenEl = document.createElement("a");
        hiddenEl.href = url;
        hiddenEl.target = "_blank";
        hiddenEl.download = "UBZ faults " + now.toUTCString() + ".html";
        hiddenEl.click();
        delete (hiddenEl);
      }

      document.querySelector("#save-file-button-spinner").classList.add("spinner-invisible");
    });

    document.querySelector("#CT-in-use").addEventListener("change", async function () {
      if (document.querySelector("#CT-in-use").value == "integrated-CT") {
        const res = await writeRegValues(150, [0]);
      } else if (document.querySelector("#CT-in-use").value == "external-CT") {
        const res = await writeRegValues(150, [1]);
      }
    });

    document.querySelector("#external-ct-current").addEventListener("change", async function () {
      await writeRegValues(151, [document.querySelector("#external-ct-current").value]);
    });

    document.querySelector("#motor-rated-current").addEventListener("change", async function () {
      await writeRegValues(152, [document.querySelector("#motor-rated-current").value]);
    });

    switchableGraphsByCheckbox("#minutes-voltage-graph", "#div-voltage-phases-graph", "#div-voltage-phases-graph-m");
    switchableGraphsByCheckbox("#minutes-amperage-graph", "#div-amperage-phases-graph", "#div-amperage-phases-graph-m");

    document.querySelector("#ubz-parameters-button").addEventListener("click", function () {
      document.querySelector("#substrate-popup-menu").style.display = 'block';
      document.querySelector("#ubz-parameters-menu").style.display = 'block';
    });

    document.querySelector("#substrate-popup-menu").addEventListener("click", function () {
      document.querySelector("#substrate-popup-menu").style.display = 'none';
      document.querySelector("#ubz-parameters-menu").style.display = 'none';
    })

    document.querySelector("#ubz-parameters-close").addEventListener("click", function () {
      document.querySelector("#substrate-popup-menu").style.display = 'none';
      document.querySelector("#ubz-parameters-menu").style.display = 'none';
    });

    var ubzParamsChanged = new Array(81).fill(false);

    for (let i = 150; i <= 230; i++) {
      document.querySelector("#ubz-param-input-" + i.toString()).addEventListener("change", function () {
        ubzParamsChanged[i - 150] = true;
      });
    }

    document.querySelector("#button-write-ubz-params").addEventListener("click", async function () {
      if (document.querySelector("#checkbox-write-only-modified-ubz-params").checked) {
        document.querySelector("#readwrite-params-spinner").classList.remove("spinner-invisible");
        for (let i = 150; i <= 230; i++) {
          if (ubzParamsChanged[i - 150]) {
            await writeRegValues(i, [document.querySelector("#ubz-param-input-" + i.toString()).value]);
          }
        }
        document.querySelector("#readwrite-params-spinner").classList.add("spinner-invisible");
      } else {
        let values = new Array();
        document.querySelector("#readwrite-params-spinner").classList.remove("spinner-invisible");
        for (let i = 150; i <= 230; i++) {
          values.push(document.querySelector("#ubz-param-input-" + i.toString()).value);
        }
        await writeRegValues(150, values);
        document.querySelector("#readwrite-params-spinner").classList.add("spinner-invisible");
      }

      ubzParamsChanged.fill(false);
    });

    document.querySelector("#button-read-ubz-params").addEventListener("click", async function () {
      document.querySelector("#readwrite-params-spinner").classList.remove("spinner-invisible");
      const ubzParams = await rawReadRegs(150, 81); // registers 150-230
      document.querySelector("#readwrite-params-spinner").classList.add("spinner-invisible");

      if (ubzParams.ok) {
        for (let i = 150; i <= 230; i++) {
          document.querySelector("#ubz-param-input-" + i.toString()).value = ubzParams.ok[i - 150];
        }
      }
    });
  </script>

  <script type="text/javascript">
    const PHASE_VOLTAGE_THRESHOLD = 220;
    const UPDATE_VISUALIZATION_INTERVAL_MS = 1000;
    const dateTimeStart = new Date();
    const initReadSpinnersList = document.querySelectorAll(".init-reading-spinner");
    const initGraphHistorySpinnersList = document.querySelectorAll(".init-graph-spinner");
    var deviceConnected = false;
    var faultIndicatorSet = false;
    var loopLock = false;

    async function initElements() {
      spinnersOn(initReadSpinnersList);
      spinnersOn(initGraphHistorySpinnersList);
      const ubzParams = await rawReadRegs(150, 81); // registers 150-230
      if (ubzParams.ok) {
        for (let i = 150; i <= 230; i++) {
          document.querySelector("#ubz-param-input-" + i.toString()).value = ubzParams.ok[i - 150];
        }

        if (ubzParams.ok[0] == 0) {
          document.querySelector("#CT-in-use").children[0].setAttribute("selected", "true");
          deactivateExternalCTsettings();
        }
        if (ubzParams.ok[0] == 1) {
          document.querySelector("#CT-in-use").children[1].setAttribute("selected", "true");
          activateExternalCTsettings();
        }

        document.querySelector("#external-ct-current").value = ubzParams.ok[1];
        document.querySelector("#motor-rated-current").value = ubzParams.ok[2];
      }
      spinnersOff(initReadSpinnersList);

      const volt1History = await readRegFromDb(114);
      const volt2History = await readRegFromDb(115);
      const volt3History = await readRegFromDb(116);
      const voltHistoryLength = Math.max(volt1History.length, volt2History.length, volt3History.length);

      const amp1History = await readRegFromDb(100);
      const amp2History = await readRegFromDb(101);
      const amp3History = await readRegFromDb(102);
      const ampHistoryLength = Math.max(amp1History.length, amp2History.length, amp3History.length);

      for (let i = voltHistoryLength - 1; i >= 0; i--) {
        const volt1 = volt1History[i][1];
        const volt2 = volt2History[i][1];
        const volt3 = volt3History[i][1];
        const t1 = new Date(volt1History[i][0]).valueOf();
        const t2 = new Date(volt2History[i][0]).valueOf();
        const t3 = new Date(volt3History[i][0]).valueOf();
        voltGraphM.addFromHistory([volt1, volt2, volt3], [t1, t2, t3]);
      }

      for (let i = ampHistoryLength - 1; i >= 0; i--) {
        const amp1 = amp1History[i][1];
        const amp2 = amp2History[i][1];
        const amp3 = amp3History[i][1];
        const t1 = new Date(amp1History[i][0]).valueOf();
        const t2 = new Date(amp2History[i][0]).valueOf();
        const t3 = new Date(amp3History[i][0]).valueOf();
        ampGraphM.addFromHistory([amp1, amp2, amp3], [t1, t2, t3]);
      }
      spinnersOff(initGraphHistorySpinnersList);

      {
        const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-1").value);
        document.querySelector("#power-show-value-1").innerHTML = characteristicString;
      }
      {
        const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-2").value);
        document.querySelector("#power-show-value-2").innerHTML = characteristicString;
      }
      {
        const characteristicString = await stringPowerCharacteristicByKey(document.querySelector("#power-characteristic-value-3").value);
        document.querySelector("#power-show-value-3").innerHTML = characteristicString;
      }
    }

    const FAULT_BIT = 0;
    const FAULT = 1;

    async function updateValuesOnVis() {
      let currentDateTime = new Date();
      let sessionTimeString = timeStringFromMillis((currentDateTime - dateTimeStart));
      document.querySelector("#session-time").innerHTML = "Session time: " + sessionTimeString;

      if (loopLock) {
        return;
      } else {
        loopLock = true;
      }

      await batchRegistersRead();
      await processUbzStatuses();
      await processArIndicator();
      await processRcIndicator();
      await processExternalInputIndicator();

      let isFault = extractBitValue(mapRegisters.get(240), FAULT_BIT) == FAULT;
      if (isFault) {
        processFaultIndicator(isFault);

        await determineFaults();

        let faultsToPrint = faultsSouldBePrinted(faultsPrev, faultsCurr);
        for (let i = 0; i < faultsCurr.length; i++) {
          if (faultsToPrint[i]) {
            let time = timeString(currentDateTime);

            const fault = alarms[i];
            if (fault.valueAddress === undefined) {
              addRow(fault.name, fault.mnemonic, "", time);
            } else {
              let valueRaw = await rawReadRegs(fault.valueAddress, 1);
              addRow(fault.name, fault.mnemonic, valueRaw.ok[0].toString(), time);
            }
          }
        }

        faultsPrev = faultsCurr;
      }

      if (mapRegisters.get(100) != undefined) {
        document.querySelector("#phase-1-current-rms-value").innerHTML = (mapRegisters.get(100) * 0.1).toFixed(1);
        document.querySelector("#phase-1-current-rms-bar").value = mapRegisters.get(100);
      } else {
        document.querySelector("#phase-1-current-rms-value").innerHTML = "Err";
        document.querySelector("#phase-1-current-rms-bar").value = 0;
      }

      if (mapRegisters.get(101) != undefined) {
        document.querySelector("#phase-2-current-rms-value").innerHTML = (mapRegisters.get(101) * 0.1).toFixed(1);
        document.querySelector("#phase-2-current-rms-bar").value = mapRegisters.get(101);
      } else {
        document.querySelector("#phase-2-current-rms-value").innerHTML = "Err";
        document.querySelector("#phase-2-current-rms-bar").value = 0;
      }

      if (mapRegisters.get(102) != undefined) {
        document.querySelector("#phase-3-current-rms-value").innerHTML = (mapRegisters.get(102) * 0.1).toFixed(1);
        document.querySelector("#phase-3-current-rms-bar").value = mapRegisters.get(102);
      } else {
        document.querySelector("#phase-3-current-rms-value").innerHTML = "Err";
        document.querySelector("#phase-3-current-rms-bar").value = 0;
      }

      ampGraph.addPoint([mapRegisters.get(100), mapRegisters.get(101), mapRegisters.get(102)]);
      ampGraphM.addPoint([mapRegisters.get(100), mapRegisters.get(101), mapRegisters.get(102)]);

      if (mapRegisters.get(103) != undefined) {
        document.querySelector("#zero-sequence-current-value").innerHTML = (mapRegisters.get(103) * 0.1).toFixed(1);
        document.querySelector("#zero-sequence-current-bar").value = mapRegisters.get(103);
      } else {
        document.querySelector("#zero-sequence-current-value").innerHTML = "Err";
        document.querySelector("#zero-sequence-current-bar").value = 0;
      }
      barValue("#zero-sequence-current-bar", 50);
      if (mapRegisters.get(104) != undefined) {
        document.querySelector("#avg-current-value-phase-1").innerHTML = (mapRegisters.get(104) * 0.1).toFixed(1);
      } else {
        document.querySelector("#avg-current-value-phase-1").innerHTML = "Err";
      }
      if (mapRegisters.get(105) != undefined) {
        document.querySelector("#avg-current-value-phase-2").innerHTML = (mapRegisters.get(105) * 0.1).toFixed(1);
      } else {
        document.querySelector("#avg-current-value-phase-2").innerHTML = "Err";
      }
      if (mapRegisters.get(106) != undefined) {
        document.querySelector("#avg-current-value-phase-3").innerHTML = (mapRegisters.get(106) * 0.1).toFixed(1);
      } else {
        document.querySelector("#avg-current-value-phase-3").innerHTML = "Err";
      }
      if (mapRegisters.get(107) != undefined) {
        document.querySelector("#max-current-value-phase-1").innerHTML = (mapRegisters.get(107) * 0.1).toFixed(1);
      } else {
        document.querySelector("#max-current-value-phase-1").innerHTML = "Err";
      }
      if (mapRegisters.get(108) != undefined) {
        document.querySelector("#max-current-value-phase-2").innerHTML = (mapRegisters.get(108) * 0.1).toFixed(1);
      } else {
        document.querySelector("#max-current-value-phase-2").innerHTML = "Err";
      }
      if (mapRegisters.get(109) != undefined) {
        document.querySelector("#max-current-value-phase-3").innerHTML = (mapRegisters.get(109) * 0.1).toFixed(1);
      } else {
        document.querySelector("#max-current-value-phase-3").innerHTML = "Err";
      }

      if (mapRegisters.get(110) != undefined && mapRegisters.get(100) != 0) {
        document.querySelector("#motor-start-current-value").innerHTML = (mapRegisters.get(110) * 0.1).toFixed(1);
      } else {
        document.querySelector("#motor-start-current-value").innerHTML = "Err";
      }
      if (mapRegisters.get(111) != undefined) {
        document.querySelector("#startup-time-value").innerHTML = mapRegisters.get(111);
      } else {
        document.querySelector("#startup-time-value").innerHTML = "Err";
      }
      if (mapRegisters.get(112) != undefined) {
        document.querySelector("#overload-current-value").innerHTML = (mapRegisters.get(112) * 0.1).toFixed(1);
      } else {
        document.querySelector("#overload-current-value").innerHTML = "Err";
      }
      if (mapRegisters.get(113) != undefined) {
        document.querySelector("#negative-sequence-current-value").innerHTML = (mapRegisters.get(113) * 0.1).toFixed(1);
        document.querySelector("#negative-sequence-current-bar").value = mapRegisters.get(113);
      } else {
        document.querySelector("#negative-sequence-current-value").innerHTML = "Err";
        document.querySelector("#negative-sequence-current-bar").value = 0;
      }
      barValue("#negative-sequence-current-bar", 2000);

      if (mapRegisters.get(114) != undefined) {
        document.querySelector("#phase-1-voltage-value").innerHTML = mapRegisters.get(114);
        document.querySelector("#phase-1-voltage-bar").value = mapRegisters.get(114);
      } else {
        document.querySelector("#phase-1-voltage-value").innerHTML = "Err";
        document.querySelector("#phase-1-voltage-bar").value = 0;
      }
      barValue("#phase-1-voltage-bar", 300, PHASE_VOLTAGE_THRESHOLD);

      if (mapRegisters.get(115) != undefined) {
        document.querySelector("#phase-2-voltage-value").innerHTML = mapRegisters.get(115);
        document.querySelector("#phase-2-voltage-bar").value = mapRegisters.get(115);
      } else {
        document.querySelector("#phase-2-voltage-value").innerHTML = "Err";
        document.querySelector("#phase-2-voltage-bar").value = 0;
      }
      barValue("#phase-2-voltage-bar", 300, PHASE_VOLTAGE_THRESHOLD);

      if (mapRegisters.get(116) != undefined) {
        document.querySelector("#phase-3-voltage-value").innerHTML = mapRegisters.get(116);
        document.querySelector("#phase-3-voltage-bar").value = mapRegisters.get(116);
      } else {
        document.querySelector("#phase-3-voltage-value").innerHTML = "Err";
        document.querySelector("#phase-3-voltage-bar").value = 0;
      }
      barValue("#phase-3-voltage-bar", 300, PHASE_VOLTAGE_THRESHOLD);

      voltGraph.addPoint([mapRegisters.get(114), mapRegisters.get(115), mapRegisters.get(116)]);
      voltGraphM.addPoint([mapRegisters.get(114), mapRegisters.get(115), mapRegisters.get(116)]);

      if (mapRegisters.get(117) != undefined) {
        document.querySelector("#line-1-voltage-value").innerHTML = mapRegisters.get(117);
        document.querySelector("#line-1-voltage-bar").value = mapRegisters.get(117);
      } else {
        document.querySelector("#line-1-voltage-value").innerHTML = "Err";
        document.querySelector("#line-1-voltage-bar").value = 0;
      }
      if (mapRegisters.get(118) != undefined) {
        document.querySelector("#line-2-voltage-value").innerHTML = mapRegisters.get(118);
        document.querySelector("#line-2-voltage-bar").value = mapRegisters.get(118);
      } else {
        document.querySelector("#line-2-voltage-value").innerHTML = "Err";
        document.querySelector("#line-2-voltage-bar").value = 0;
      }
      if (mapRegisters.get(119) != undefined) {
        document.querySelector("#line-3-voltage-value").innerHTML = mapRegisters.get(119);
        document.querySelector("#line-3-voltage-bar").value = mapRegisters.get(119);
      } else {
        document.querySelector("#line-3-voltage-value").innerHTML = "Err";
        document.querySelector("#line-3-voltage-bar").value = 0;
      }

      if (mapRegisters.get(150) != undefined) {
        if (mapRegisters.get(150) == 0) {
          document.querySelector("#CT-in-use").children[0].setAttribute("selected", "true");
          deactivateExternalCTsettings();
        }
        if (mapRegisters.get(150) == 1) {
          document.querySelector("#CT-in-use").children[1].setAttribute("selected", "true");
          activateExternalCTsettings();
        }
      }

      if (mapRegisters.get(151) != undefined) {
        document.querySelector("#external-ct-current").value = mapRegisters.get(151);
      }

      if (mapRegisters.get(152) != undefined) {
        document.querySelector("#motor-rated-current").value = mapRegisters.get(152);
      }

      if (mapRegisters.get(153) != undefined) {
        document.querySelector("#current-average-for-time-value").innerHTML = mapRegisters.get(153);
      } else {
        document.querySelector("#current-average-for-time-value").innerHTML = "Err";
      }

      if (mapRegisters.get(177) != undefined && mapRegisters.get(180) != undefined) {
        barValue("#line-1-voltage-bar", 475, mapRegisters.get(177), mapRegisters.get(180));
        barValue("#line-2-voltage-bar", 475, mapRegisters.get(177), mapRegisters.get(180));
        barValue("#line-3-voltage-bar", 475, mapRegisters.get(177), mapRegisters.get(180));
      }

      if (mapRegisters.get(120) != undefined) {
        document.querySelector("#positive-sequence-voltage-value").innerHTML = mapRegisters.get(120);
      } else {
        document.querySelector("#positive-sequence-voltage-value").innerHTML = "Err";
      }

      if (mapRegisters.get(121) != undefined) {
        document.querySelector("#negative-sequence-voltage-value").innerHTML = mapRegisters.get(121);
        document.querySelector("#negative-sequence-voltage-bar").value = mapRegisters.get(121);
      } else {
        document.querySelector("#negative-sequence-voltage-value").innerHTML = "Err";
        document.querySelector("#negative-sequence-voltage-bar").value = 0;
      }
      barValue("#negative-sequence-voltage-bar", 300);

      if (mapRegisters.get(122) != undefined) {
        document.querySelector("#zero-sequence-voltage-value").innerHTML = mapRegisters.get(122);
      } else {
        document.querySelector("#zero-sequence-voltage-value").innerHTML = "Err";
      }

      if (mapRegisters.get(123) != undefined) {
        document.querySelector("#sensor-1-temperature-value").innerHTML = temperatureSensorReadable(mapRegisters.get(123));
      } else {
        document.querySelector("#sensor-1-temperature-value").innerHTML = "Err";
      }
      if (mapRegisters.get(124) != undefined) {
        document.querySelector("#sensor-2-temperature-value").innerHTML = temperatureSensorReadable(mapRegisters.get(124));
      } else {
        document.querySelector("#sensor-2-temperature-value").innerHTML = "Err";
      }
      if (mapRegisters.get(125) != undefined) {
        document.querySelector("#current-input-value").innerHTML = (mapRegisters.get(125) * 0.01).toFixed(2);
      } else {
        document.querySelector("#current-input-value").innerHTML = "Err";
      }

      if (mapRegisters.get(126) != undefined) {
        document.querySelector("#analog-input-value").innerHTML = (mapRegisters.get(126) * 0.1).toFixed(1);
      } else {
        document.querySelector("#analog-input-value").innerHTML = "Err";
      }

      if (mapRegisters.get(128) != undefined) {
        document.querySelector("#frequency-value").innerHTML = (mapRegisters.get(128) * 0.1).toFixed(1);
      } else {
        document.querySelector("#frequency-value").innerHTML = "Err";
      }

      if (mapRegisters.get(132) != undefined) {
        document.querySelector("#insulation-resistance-value").innerHTML = (mapRegisters.get(132) * 0.1).toFixed(1);
      } else {
        document.querySelector("#insulation-resistance-value").innerHTML = "Err";
      }

      if (mapRegisters.get(130) != undefined) {
        if (mapRegisters.get(130) == 0) {
          document.querySelector("#time-before-ar-string").innerHTML = "Off";
          document.querySelector("#time-before-ar-bar").value = 0;
        } else if (mapRegisters.get(130) > 0 && mapRegisters.get(130) <= 900) {
          document.querySelector("#time-before-ar-string").innerHTML = mapRegisters.get(130).toString();
          document.querySelector("#time-before-ar-bar").value = mapRegisters.get(130);
        } else if (mapRegisters.get(130) == 950) {
          document.querySelector("#time-before-ar-string").innerHTML = "No AR";
          document.querySelector("#time-before-ar-bar").value = 0;
        } else {
          document.querySelector("#time-before-ar-string").innerHTML = "???";
          document.querySelector("#time-before-ar-bar").value = 0;
        }
      } else {
        document.querySelector("#time-before-ar-string").innerHTML = "Err";
        document.querySelector("#time-before-ar-bar").value = 0;
      }
      barValue("#negative-sequence-voltage-bar", 900);

      if (mapRegisters.get(205) != undefined) {
        if (mapRegisters.get(205) == 0) {
          document.querySelector("#radio-workmode-alarm").checked = true;
        } else if (mapRegisters.get(205) == 1) {
          document.querySelector("#radio-workmode-time").checked = true;
        } else if (mapRegisters.get(205) == 2) {
          document.querySelector("#radio-workmode-stardelta").checked = true;
        }
      }

      let heatValue = mapRegisters.get(133);
      if (heatValue != undefined) {
        if (heatValue > 0) {
          document.querySelector("#div-heating-graph").style.display = "block";
        }
        if (document.querySelector("#div-heating-graph").style.display != "none") {
          const heatPercentage = (heatValue / 1100000) * 100;
          let _color = determineHeatgraphColor(heatPercentage);
          tempGraph.addPoint([heatPercentage, 66, 100]);
        }
      } else if (document.querySelector("#div-heating-graph").style.display != "none") {
        tempGraph.addPoint([undefined, 66, 100]);
      }

      if (mapRegisters.get(135) != undefined) {
        document.querySelector("#full-power-value").innerHTML = (mapRegisters.get(135) * 0.01).toString();
      } else {
        document.querySelector("#full-power-value").innerHTML = "Reading error";
      }

      if (mapRegisters.get(137) != undefined) {
        document.querySelector("#active-power-value").innerHTML = (mapRegisters.get(137) * 0.01).toString();
      } else {
        document.querySelector("#active-power-value").innerHTML = "Reading error";
      }

      if (mapRegisters.get(139) != undefined) {
        document.querySelector("#reactive-power-value").innerHTML = (mapRegisters.get(139) * 0.01).toString();
      } else {
        document.querySelector("#reactive-power-value").innerHTML = "Reading error";
      }

      if (mapRegisters.get(129) > 600) {
        document.querySelector("#time-before-overload-tripping-string").innerHTML = "No";
      } else if (mapRegisters.get(129) != undefined) {
        document.querySelector("#time-before-overload-tripping-string").innerHTML = mapRegisters.get(129).toString();
      } else {
        document.querySelector("#time-before-overload-tripping-string").innerHTML = "Reading error";
      }

      if (mapRegisters.get(131) > 900) {
        document.querySelector("#wait-time-after-overload-deenergize-string").innerHTML = "No";
      } else if (mapRegisters.get(131) != undefined) {
        document.querySelector("#wait-time-after-overload-deenergize-string").innerHTML = mapRegisters.get(131).toString();
      } else {
        document.querySelector("#wait-time-after-overload-deenergize-string").innerHTML = "Err";
      }

      loopLock = false;
    }

    initElements();
    setInterval(updateValuesOnVis, UPDATE_VISUALIZATION_INTERVAL_MS);
  </script>
</div>